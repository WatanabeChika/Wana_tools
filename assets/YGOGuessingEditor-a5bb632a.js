import{_ as ut,r as h,o as ft,a as L,c as N,b as s,e as $,j as I,h as x,f as D,t as pt,i as mt,F as vt,p as gt,g as ht}from"./index-67ec0f25.js";import{F as xt,l as bt,s as yt}from"./utils-4b240ca0.js";import"./_commonjsHelpers-de833af9.js";const S=k=>(gt("data-v-d48dee34"),k=k(),ht(),k),_t=S(()=>s("h1",null,"游戏王卡图猜猜杯制作器",-1)),wt={id:"input-container"},Tt={id:"modes-settings"},$t=S(()=>s("span",{id:"matching-hint"},"主题选择: ",-1)),kt={class:"radio-group"},Et={id:"modes-settings"},St=S(()=>s("span",{id:"matching-hint"},"矩阵大小: ",-1)),Rt={id:"button-container"},Ct=["disabled"],Wt=["disabled"],At=["disabled"],Ft={id:"canvas-container"},Bt=S(()=>s("div",{id:"notice"},[s("p",null,"注意：数据更新至 2025.12.11。"),s("p",null,[x("图片及数据来源： "),s("a",{href:"https://ygocdb.com"},"百鸽")]),s("p",null,[x("种族/属性信息摘自： "),s("a",{href:"https://zh.wikipedia.org/wiki/%E9%81%8A%E6%88%B2%E7%8E%8B%E9%9B%86%E6%8F%9B%E7%B4%99%E7%89%8C%E9%81%8A%E6%88%B2"},"游戏王中文维基")])],-1)),It={__name:"YGOGuessingEditor",setup(k){const R=["龙","魔法师","不死","战士","兽战士","兽","鸟兽","恶魔","天使","昆虫","恐龙","爬虫类","鱼","海龙","机械","雷","水","炎","岩石","植物","念动力","幻龙","电子界","幻想魔","幻神兽","创造神"],C=["暗","光","地","水","炎","风","神"],P=["怪兽","魔法","陷阱"],r=h("race"),E=h(3),f=h(4),g=h(!1),y=h(!1),W=h(null),A=h(null),X=new xt("KaiTi");ft(async()=>{await Promise.all([X.check()])});const K=o=>{if(!o||!o.text||!o.text.types)return"未知";const e=o.text.types;if(r.value==="category")return e.includes("魔法")?"魔法":e.includes("陷阱")?"陷阱":e.includes("怪兽")?"怪兽":"未知";const n=/](.*?)\/(.*?)(\n|$)/,i=e.match(n);if(i){const t=i[1].trim(),a=i[2].trim();if(r.value==="race")return R.find(l=>t===l||t.includes(l))||"未知";if(r.value==="attribute")return C.find(l=>a===l||a.includes(l))||"未知"}return r.value==="attribute"?C.find(a=>e.includes("/"+a)||e.includes("/ "+a))||"未知":[...R].sort((c,l)=>l.length-c.length).find(c=>e.includes(c))||"未知"},q=async()=>{const o=await(await fetch("cards.json")).json(),e=Object.values(o);let n=[];return r.value==="category"?n=e:n=e.filter(t=>t.text&&t.text.types&&t.text.types.includes("怪兽")),yt([...n])[0].slice(0,E.value*f.value)},J=(o,e,n,i,t,a)=>{const c=e.split("  ");let l="",d=i;for(let p=0;p<c.length;p++){const u=l+c[p]+"  ";o.measureText(u).width>t&&p>0?(o.fillText(l,n,d),l=c[p]+"  ",d+=a):l=u}return o.fillText(l,n,d),d+a},Q=(o,e,n,i)=>{const t=e.split("  ");let a="",c=1;for(let l=0;l<t.length;l++){const d=a+t[l]+"  ";o.measureText(d).width>n&&l>0?(a=t[l]+"  ",c++):a=d}return c*i},Z=async()=>{if(!g.value){g.value=!0,y.value=!1;try{const o=await q();if(o.length===0){g.value=!1,alert("未找到数据");return}const e=r.value==="race"?R:r.value==="attribute"?C:P,n=await Promise.all(o.map(async i=>{const t=i.text.types.includes("灵摆"),a=t?"!artp":"!art",c=`cdn.233.momobako.com/ygopro/pics/${i.id}.jpg${a}`,l=`https://wsrv.nl/?url=${encodeURIComponent(c)}`;try{return{img:await bt(l),isPendulum:t,answer:K(i)}}catch(d){return console.warn(`Failed to load image for card ${i.id}`,d),null}}));setTimeout(()=>{y.value=!0,setTimeout(()=>{U(W.value,n,e,!1),U(A.value,n,e,!0),g.value=!1},50)},0)}catch(o){console.error(o),alert("生成过程中发生错误"),g.value=!1}}},U=(o,e,n,i)=>{if(!o)return;const t=o.getContext("2d"),a=40,c=256,l=256,d=20,p=60,u="KaiTi",G=48,_=28,tt=32,et=24,nt=`看游戏王卡图猜${r.value==="race"?"种族":r.value==="attribute"?"属性":"种类"}`,H=100,O=n.map((m,v)=>`${v+1}.${m}`).join("  "),st=c*f.value+d*(f.value-1),b=Math.max(800,st+a*2),Y=b-a*2;t.font=`${_}px ${u}`;const ot=_+15,lt=Q(t,O,Y,ot)+20,j=a+H+lt,F=j+E.value*(l+p)+a;o.width=b,o.height=F,t.fillStyle="white",t.fillRect(0,0,b,F),t.fillStyle="black",t.font=`bold ${G}px ${u}`,t.textAlign="center",t.textBaseline="top",t.fillText(nt,b/2,a),t.font=`${_}px ${u}`,t.textAlign="left",t.fillStyle="#333",J(t,O,a,a+H,Y,_+15);const at=f.value*c+(f.value-1)*d,it=(b-at)/2;for(let m=0;m<e.length;m++){const v=e[m];if(!v)continue;const ct=Math.floor(m/f.value),rt=m%f.value,w=it+rt*(c+d),T=j+ct*(l+p);v.isPendulum?t.drawImage(v.img,w,T+20,256,216):t.drawImage(v.img,w,T,256,256),t.strokeStyle="#ddd",t.lineWidth=2,t.strokeRect(w,T,256,256),t.font=`bold ${et}px ${u}`,t.fillStyle="#000",t.textAlign="left",t.fillText(`#${m+1}`,w+5,T+l+15);const M=w+c/2+10,z=T+l+10;if(t.font=`${tt}px ${u}`,t.textAlign="center",i){const B=n.indexOf(v.answer),dt=B!==-1?`${B+1}.`:"";t.fillText(`( ${dt}${v.answer} )`,M,z)}else t.fillText("(          )",M,z)}t.fillStyle="#999",t.font=`14px ${u}`,t.textAlign="right",t.fillText("Created by Wanakachi",b-10,F-18)},V=o=>{const e=o?A.value:W.value;if(!e)return;const n=e.toDataURL("image/png"),i=document.createElement("a");i.href=n,i.download=o?"游戏王卡图猜猜杯_答案.png":"游戏王卡图猜猜杯_题目.png",i.click()};return(o,e)=>(L(),N(vt,null,[_t,s("div",wt,[s("div",Tt,[$t,s("div",kt,[s("label",null,[$(s("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=n=>r.value=n),value:"race"},null,512),[[I,r.value]]),x(" 种族")]),s("label",null,[$(s("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=n=>r.value=n),value:"attribute"},null,512),[[I,r.value]]),x(" 属性")]),s("label",null,[$(s("input",{type:"radio","onUpdate:modelValue":e[2]||(e[2]=n=>r.value=n),value:"category"},null,512),[[I,r.value]]),x(" 种类")])])]),s("div",Et,[St,s("div",null,[$(s("input",{type:"number","onUpdate:modelValue":e[3]||(e[3]=n=>E.value=n),min:"1",max:"10",class:"num-input"},null,512),[[D,E.value,void 0,{number:!0}]]),x(" 行 × "),$(s("input",{type:"number","onUpdate:modelValue":e[4]||(e[4]=n=>f.value=n),min:"1",max:"10",class:"num-input"},null,512),[[D,f.value,void 0,{number:!0}]]),x(" 列 ")])]),s("div",Rt,[s("button",{onClick:Z,disabled:g.value,class:"btns",style:{"background-color":"cornflowerblue"}},pt(g.value?"生成中...":"绘制图片"),9,Ct),s("button",{onClick:e[5]||(e[5]=n=>V(!1)),disabled:!y.value,class:"btns"},"下载图片",8,Wt),s("button",{onClick:e[6]||(e[6]=n=>V(!0)),disabled:!y.value,class:"btns"},"下载答案",8,At)])]),s("div",Ft,[y.value?(L(),N("canvas",{key:0,ref_key:"canvasVisible",ref:W},null,512)):mt("",!0),s("canvas",{ref_key:"canvasHidden",ref:A,style:{display:"none"}},null,512)]),Bt],64))}},jt=ut(It,[["__scopeId","data-v-d48dee34"]]);export{jt as default};
