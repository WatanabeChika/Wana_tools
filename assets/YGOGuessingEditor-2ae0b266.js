import{_ as $e,r as b,o as Te,a as Q,c as Z,b as l,e as w,j as R,h as g,f as ee,t as Se,i as ke,F as Ee,p as Re,g as Be}from"./index-a788922b.js";import{F as We,l as Ae,s as Ce}from"./utils-4b240ca0.js";import"./_commonjsHelpers-de833af9.js";const B=k=>(Re("data-v-abd0fa53"),k=k(),Be(),k),Fe=B(()=>l("h1",null,"游戏王卡图猜猜杯制作器",-1)),Ue={id:"input-container"},Ie={id:"modes-settings"},Ve=B(()=>l("span",{id:"matching-hint"},"主题选择: ",-1)),Ge={class:"radio-group"},He={id:"modes-settings"},Ye=B(()=>l("span",{id:"matching-hint"},"矩阵大小: ",-1)),Me={id:"button-container"},Oe=["disabled"],je=["disabled"],ze=["disabled"],De={id:"canvas-container"},Le=B(()=>l("div",{id:"notice"},[l("p",null,"注意：数据更新至 2025.12.11。"),l("p",null,[g("图片及数据来源： "),l("a",{href:"https://ygocdb.com"},"百鸽")]),l("p",null,[g("种族/属性/种类信息摘自： "),l("a",{href:"https://zh.wikipedia.org/wiki/%E9%81%8A%E6%88%B2%E7%8E%8B%E9%9B%86%E6%8F%9B%E7%B4%99%E7%89%8C%E9%81%8A%E6%88%B2"},"游戏王中文维基")])],-1)),Ne={__name:"YGOGuessingEditor",setup(k){const W=["龙","魔法师","不死","战士","兽战士","兽","鸟兽","恶魔","天使","昆虫","恐龙","爬虫类","鱼","海龙","机械","雷","水","炎","岩石","植物","念动力","幻龙","电子界","幻想魔","幻神兽","创造神"],A=["暗","光","地","水","炎","风","神"],te=["怪兽","魔法","陷阱"],ne=["通常怪兽","效果怪兽","仪式怪兽","融合怪兽","同调怪兽","超量怪兽","灵摆怪兽","连接怪兽","通常魔法","仪式魔法","速攻魔法","永续魔法","装备魔法","场地魔法","通常陷阱","永续陷阱","反击陷阱"],a=b("race"),E=b(3),m=b(4),h=b(!1),$=b(!1),C=b(null),F=b(null),le=new We("KaiTi");Te(async()=>{await Promise.all([le.check()])});const se=i=>{if(!i||!i.text||!i.text.types)return"未知";const t=i.text.types;if(a.value==="category")return t.includes("魔法")?"魔法":t.includes("陷阱")?"陷阱":t.includes("怪兽")?"怪兽":"未知";if(a.value==="subcategory")return t.includes("魔法")?t.includes("仪式")?"仪式魔法":t.includes("速攻")?"速攻魔法":t.includes("永续")?"永续魔法":t.includes("装备")?"装备魔法":t.includes("场地")?"场地魔法":"通常魔法":t.includes("陷阱")?t.includes("永续")?"永续陷阱":t.includes("反击")?"反击陷阱":"通常陷阱":t.includes("仪式")?"仪式怪兽":t.includes("融合")?"融合怪兽":t.includes("同调")?"同调怪兽":t.includes("超量")?"超量怪兽":t.includes("连接")?"连接怪兽":t.includes("灵摆")?"灵摆怪兽":t.includes("通常")?"通常怪兽":"效果怪兽";const n=/](.*?)\/(.*?)(\n|$)/,r=t.match(n);if(r){const e=r[1].trim(),s=r[2].trim();if(a.value==="race")return W.find(o=>e===o||e.includes(o))||"未知";if(a.value==="attribute")return A.find(o=>s===o||s.includes(o))||"未知"}return a.value==="attribute"?A.find(s=>t.includes("/"+s)||t.includes("/ "+s))||"未知":[...W].sort((u,o)=>o.length-u.length).find(u=>t.includes(u))||"未知"},ie=async()=>{const i=await(await fetch("cards.json")).json(),t=i.default||i,n=Object.values(t);let r=[];return a.value==="category"||a.value==="subcategory"?r=n:r=n.filter(s=>s.text&&s.text.types&&s.text.types.includes("怪兽")),Ce([...r])[0].slice(0,E.value*m.value)},oe=(i,t,n,r,e,s)=>{const u=t.split("  ");let o="",c=r;for(let v=0;v<u.length;v++){const d=o+u[v]+"  ";i.measureText(d).width>e&&v>0?(i.fillText(o,n,c),o=u[v]+"  ",c+=s):o=d}return i.fillText(o,n,c),c+s},ae=(i,t,n,r)=>{const e=t.split("  ");let s="",u=1;for(let o=0;o<e.length;o++){const c=s+e[o]+"  ";i.measureText(c).width>n&&o>0?(s=e[o]+"  ",u++):s=c}return u*r},re=async()=>{if(!h.value){h.value=!0,$.value=!1;try{const i=await ie();if(i.length===0){h.value=!1,alert("未找到数据");return}let t=[];a.value==="race"?t=W:a.value==="attribute"?t=A:a.value==="category"?t=te:a.value==="subcategory"&&(t=ne);const n=await Promise.all(i.map(async r=>{const e=r.text.types.includes("灵摆"),s=e?"!artp":"!art",u=`cdn.233.momobako.com/ygopro/pics/${r.id}.jpg${s}`,o=`https://wsrv.nl/?url=${encodeURIComponent(u)}&t=${new Date().getTime()}_${Math.random()}`;try{return{img:await Ae(o),isPendulum:e,answer:se(r),name:r.cn_name||r.jp_name||"未知卡名"}}catch(c){return console.warn(`Failed to load image for card ${r.id}`,c),null}}));setTimeout(()=>{$.value=!0,setTimeout(()=>{O(C.value,n,t,!1),O(F.value,n,t,!0),h.value=!1},50)},0)}catch(i){console.error(i),alert("生成过程中发生错误"),h.value=!1}}},O=(i,t,n,r)=>{if(!i)return;const e=i.getContext("2d"),s=40,u=256,o=256,c=20,v=60,d="KaiTi",z=48,T=28,ue=28,ce=24;let S="";a.value==="race"?S="种族":a.value==="attribute"?S="属性":a.value==="category"?S="卡片种类":a.value==="subcategory"&&(S="细分种类");const de=`看游戏王卡图猜${S}`,D=100,L=n.map((p,f)=>`${f+1}.${p}`).join("  "),fe=u*m.value+c*(m.value-1),y=Math.max(800,fe+s*2),N=y-s*2;e.font=`${T}px ${d}`;const pe=T+15,me=ae(e,L,N,pe);let P=0;a.value==="subcategory"&&(P=40);const ve=me+20+P,X=s+D+ve,U=X+E.value*(o+v)+s;i.width=y,i.height=U,e.fillStyle="white",e.fillRect(0,0,y,U),e.fillStyle="black",e.font=`bold ${z}px ${d}`,e.textAlign="center",e.textBaseline="top",e.fillText(de,y/2,s),e.font=`${T}px ${d}`,e.textAlign="left",e.textBaseline="alphabetic",e.fillStyle="#333";const ge=oe(e,L,s,s+D,N,T+15);if(a.value==="subcategory"){e.fillStyle="#666",e.font=`20px ${d}`;const p="“通常怪兽”/“效果怪兽”是非额外非灵摆怪兽，“灵摆怪兽”是非额外怪兽。";e.fillText(p,s,ge+10)}const he=m.value*u+(m.value-1)*c,xe=(y-he)/2;for(let p=0;p<t.length;p++){const f=t[p];if(!f)continue;const be=Math.floor(p/m.value),ye=p%m.value,x=xe+ye*(u+c),_=X+be*(o+v);f.isPendulum?e.drawImage(f.img,x,_+20,256,216):e.drawImage(f.img,x,_,256,256),e.strokeStyle="#ddd",e.lineWidth=2,e.strokeRect(x,_,256,256),e.font=`bold ${ce}px ${d}`,e.fillStyle="#000",e.textAlign="left",e.textBaseline="alphabetic",e.fillText(`#${p+1}`,x+5,_+o+33);const K=x+u/2+13,q=_+o+33;if(e.font=`${ue}px ${d}`,e.textAlign="center",r){const I=n.indexOf(f.answer),_e=I!==-1?`${I+1}.`:"";if(e.fillText(`( ${_e}${f.answer} )`,K,q),f.name){e.save();const V=24;e.font=`bold ${V}px ${d}`;let G=e.measureText(f.name).width;const H=u-10;let Y=V;if(G>H){const we=H/G;Y=Math.floor(V*we),e.font=`bold ${Y}px ${d}`,G=H}const M=Y+14,J=_+256-M;e.fillStyle="rgba(0, 0, 0, 0.65)",e.fillRect(x,J,u,M),e.fillStyle="#fff",e.textAlign="center",e.textBaseline="middle",e.fillText(f.name,x+u/2,J+M/2),e.restore()}}else e.fillText("(          )",K,q)}e.fillStyle="#999",e.font=`14px ${d}`,e.textAlign="right",e.textBaseline="alphabetic",e.fillText("Created by Wanakachi",y-10,U-18)},j=i=>{const t=i?F.value:C.value;if(!t)return;const n=t.toDataURL("image/png"),r=document.createElement("a");r.href=n,r.download=i?"游戏王卡图猜猜杯_答案.png":"游戏王卡图猜猜杯_题目.png",r.click()};return(i,t)=>(Q(),Z(Ee,null,[Fe,l("div",Ue,[l("div",Ie,[Ve,l("div",Ge,[l("label",null,[w(l("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=n=>a.value=n),value:"race"},null,512),[[R,a.value]]),g(" 种族")]),l("label",null,[w(l("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=n=>a.value=n),value:"attribute"},null,512),[[R,a.value]]),g(" 属性")]),l("label",null,[w(l("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=n=>a.value=n),value:"category"},null,512),[[R,a.value]]),g(" 卡片种类")]),l("label",null,[w(l("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=n=>a.value=n),value:"subcategory"},null,512),[[R,a.value]]),g(" 细分种类")])])]),l("div",He,[Ye,l("div",null,[w(l("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=n=>E.value=n),min:"1",max:"10",class:"num-input"},null,512),[[ee,E.value,void 0,{number:!0}]]),g(" 行 × "),w(l("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=n=>m.value=n),min:"1",max:"10",class:"num-input"},null,512),[[ee,m.value,void 0,{number:!0}]]),g(" 列 ")])]),l("div",Me,[l("button",{onClick:re,disabled:h.value,class:"btns primary-btn"},Se(h.value?"生成中...":"绘制图片"),9,Oe),l("button",{onClick:t[6]||(t[6]=n=>j(!1)),disabled:!$.value,class:"btns download-btn"},"下载图片",8,je),l("button",{onClick:t[7]||(t[7]=n=>j(!0)),disabled:!$.value,class:"btns download-btn"},"下载答案",8,ze)])]),l("div",De,[$.value?(Q(),Z("canvas",{key:0,ref_key:"canvasVisible",ref:C},null,512)):ke("",!0),l("canvas",{ref_key:"canvasHidden",ref:F,style:{display:"none"}},null,512)]),Le],64))}},Je=$e(Ne,[["__scopeId","data-v-abd0fa53"]]);export{Je as default};
