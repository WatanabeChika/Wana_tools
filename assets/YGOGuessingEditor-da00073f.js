import{_ as He,r as v,w as Ee,j as Ye,o as Oe,a as g,c as x,b as s,e as m,k as K,h as y,f as ce,l as Le,F as de,d as be,t as X,v as ge,i as q,m as De,q as Ke,p as Xe,g as qe}from"./index-803c98e3.js";import{F as Qe,l as Je,s as W}from"./utils-0b72f588.js";import"./_commonjsHelpers-de833af9.js";const B=se=>(Xe("data-v-78b9180b"),se=se(),qe(),se),Ze=B(()=>s("h1",null,"游戏王卡图猜猜杯制作器",-1)),et={id:"input-container"},tt={id:"modes-settings"},lt=B(()=>s("span",{id:"matching-hint"},"题目形式: ",-1)),nt={class:"radio-group"},st={id:"modes-settings"},at=B(()=>s("span",{id:"matching-hint"},"主题选择: ",-1)),it={class:"radio-group"},ot={key:0,id:"modes-settings"},rt=B(()=>s("span",{id:"matching-hint"},"判断配置: ",-1)),ut=B(()=>s("span",{style:{"font-size":"14px",margin:"0 5px"}},"找出",-1)),ct=["max"],dt=B(()=>s("span",{style:{"font-size":"14px",margin:"0 5px 10px 5px"}},"个",-1)),ft=["value"],vt={style:{"margin-left":"10px","font-weight":"normal"}},pt={id:"modes-settings"},ht=B(()=>s("span",{id:"matching-hint"},"矩阵大小: ",-1)),mt={id:"modes-settings"},bt=B(()=>s("span",{id:"matching-hint"},"筛选设置: ",-1)),gt={style:{display:"flex","align-items":"center"}},xt={key:0,class:"inline-search-wrapper"},yt=["disabled"],_t=["disabled"],wt={key:0,class:"search-results-dropdown"},$t=["onClick"],St={class:"search-name"},kt={class:"search-id"},Tt={key:1,class:"search-results-dropdown"},Ct=B(()=>s("div",{class:"search-item",style:{cursor:"default"}},"未找到卡片",-1)),Rt=[Ct],Mt={key:1,class:"selected-cards-row"},At=["onClick"],Et={id:"button-container"},Bt=["disabled"],Ut=["disabled"],Vt=["disabled"],Wt={id:"canvas-container"},jt=Ke('<div id="notice" data-v-78b9180b><p data-v-78b9180b>卡图及卡片数据来源： <a href="https://ygocdb.com" data-v-78b9180b>百鸽</a></p><p data-v-78b9180b>常用卡统计来源： <a href="https://mycard.world/ygopro/arena/index.html" data-v-78b9180b>MCPro 决斗数据库</a></p><p data-v-78b9180b>种族/属性/种类信息摘自： <a href="https://zh.wikipedia.org/wiki/%E9%81%8A%E6%88%B2%E7%8E%8B%E9%9B%86%E6%8F%9B%E7%B4%99%E7%89%8C%E9%81%8A%E6%88%B2" data-v-78b9180b>游戏王中文维基</a></p><p data-v-78b9180b>注意：数据更新有延迟。请查看 <a href="https://github.com/WatanabeChika/Wana_tools/blob/main/README.md" data-v-78b9180b> README </a> 获取最近更新时间。 </p></div>',1),It={__name:"YGOGuessingEditor",setup(se){const H=["龙","魔法师","不死","战士","兽战士","兽","鸟兽","恶魔","天使","昆虫","恐龙","爬虫类","鱼","海龙","机械","雷","水","炎","岩石","植物","念动力","幻龙","电子界","幻想魔","幻神兽","创造神"],ae=["暗","光","地","水","炎","风","神"],xe=["怪兽","魔法","陷阱"],ye=["通常怪兽","效果怪兽","仪式怪兽","融合怪兽","同调怪兽","超量怪兽","灵摆怪兽","连接怪兽","通常魔法","仪式魔法","速攻魔法","永续魔法","装备魔法","场地魔法","通常陷阱","永续陷阱","反击陷阱"],_=v("fill"),o=v("race"),Y=v(3),w=v(4),ie=v(!1),b=v(""),O=v(1),L=v(!1),Q=v(!1),oe=v(""),J=v([]),k=v([]),Z=v(!1),ee=v(!1),j=v(!1),re=v(!0),te=v(!1),fe=v(null),ve=v(null);let _e=[],we=new Set;Ee(o,n=>{n==="race"?b.value=H[0]:n==="attribute"?b.value=ae[0]:n==="category"?b.value=xe[0]:n==="subcategory"&&(b.value=ye[0])}),Ee([Y,w],([n,l])=>{const t=n*l-1;O.value>t&&(O.value=Math.max(1,t))});const pe=Ye(()=>o.value==="race"?H:o.value==="attribute"?ae:o.value==="category"?xe:o.value==="subcategory"?ye:[]),Be=new Qe("KaiTi");Oe(async()=>{const n=Be.check(),l=fetch("cards/cards.json").then(e=>e.json()).then(e=>{const a=e.default||e;_e=Object.values(a)}),t=fetch("cards/common_cards.json").then(e=>e.json()).then(e=>{const a=e.default||e;we=new Set(a.map(i=>Number(i)))}).catch(()=>null);try{await Promise.all([n,l,t]),b.value=H[0],re.value=!1}catch(e){console.error("初始化失败",e),alert("数据加载发生错误，请刷新重试")}});const $e=async()=>{if(oe.value.trim()){Z.value=!0,J.value=[],ee.value=!1;try{const l=await(await fetch(`https://ygocdb.com/api/v0/?search=${encodeURIComponent(oe.value)}`)).json();l&&l.result&&(J.value=l.result.filter(t=>t.id&&(t.cn_name||t.jp_name)),ee.value=!0)}catch(n){console.error("搜索失败",n),alert("搜索失败，请检查网络或稍后重试")}finally{Z.value=!1}}},Ue=n=>{if(k.value.length>=100){alert("最多只能指定100张卡片");return}k.value.find(l=>l.id===n.id)||k.value.push(n),ee.value=!1},Ve=n=>{k.value.splice(n,1)},We=()=>{k.value=[]},le=(n,l)=>{if(!n||!n.text||!n.text.types)return!1;const t=n.text.types,e=o.value;if(e==="category"){if(l==="怪兽")return t.includes("怪兽");if(l==="魔法")return t.includes("魔法");if(l==="陷阱")return t.includes("陷阱")}else if(e==="subcategory"){if(l==="通常怪兽")return t.includes("通常")&&t.includes("怪兽");if(l==="效果怪兽")return!t.includes("通常")&&t.includes("怪兽")&&!t.includes("仪式")&&!t.includes("融合")&&!t.includes("同调")&&!t.includes("超量")&&!t.includes("连接")&&!t.includes("灵摆");const a=l.replace("怪兽","").replace("魔法","").replace("陷阱","");return l==="通常魔法"?t.includes("魔法")&&!["仪式","速攻","永续","装备","场地"].some(i=>t.includes(i)):l==="通常陷阱"?t.includes("陷阱")&&!["永续","反击"].some(i=>t.includes(i)):t.includes(a)}else if(e==="race"){const a=/](.*?)\/(.*?)(\n|$)/,i=t.match(a);return i?i[1].trim()===l:!1}else if(e==="attribute"){const a=/](.*?)\/(.*?)(\n|$)/,i=t.match(a);return i?i[2].trim()===l:t.includes(l)}return!1},je=n=>{if(!n||!n.text||!n.text.types)return"未知";const l=n.text.types;if(o.value==="category")return l.includes("魔法")?"魔法":l.includes("陷阱")?"陷阱":l.includes("怪兽")?"怪兽":"未知";if(o.value==="subcategory")return l.includes("魔法")?l.includes("仪式")?"仪式魔法":l.includes("速攻")?"速攻魔法":l.includes("永续")?"永续魔法":l.includes("装备")?"装备魔法":l.includes("场地")?"场地魔法":"通常魔法":l.includes("陷阱")?l.includes("永续")?"永续陷阱":l.includes("反击")?"反击陷阱":"通常陷阱":l.includes("仪式")?"仪式怪兽":l.includes("融合")?"融合怪兽":l.includes("同调")?"同调怪兽":l.includes("超量")?"超量怪兽":l.includes("连接")?"连接怪兽":l.includes("灵摆")?"灵摆怪兽":l.includes("通常")?"通常怪兽":"效果怪兽";const t=/](.*?)\/(.*?)(\n|$)/,e=l.match(t);if(e){const a=e[1].trim(),i=e[2].trim();if(o.value==="race"){const u=H.find(c=>a===c);return u||[...H].sort((c,T)=>T.length-c.length).find(c=>a.includes(c))||"未知"}else if(o.value==="attribute")return ae.find(r=>i===r||i.includes(r))||"未知"}return o.value==="attribute"?ae.find(i=>l.includes("/"+i)||l.includes("/ "+i))||"未知":[...H].sort((u,r)=>r.length-u.length).find(u=>l.includes(u))||"未知"},Ie=async()=>{if(re.value)return alert("数据正在初始化，请稍后再试..."),[];let n=_e;(o.value==="race"||o.value==="attribute")&&(n=n.filter(e=>e.text&&e.text.types&&e.text.types.includes("怪兽"))),ie.value&&(n=n.filter(e=>we.has(Number(e.id))));let l=[];Q.value&&k.value.length>0&&(l=k.value.filter(e=>o.value==="race"||o.value==="attribute"?e.text&&e.text.types&&e.text.types.includes("怪兽"):!0));const t=Y.value*w.value;if(_.value==="fill"){let a=[...W([...l],!1).slice(0,t)];if(a.length<t){const i=t-a.length,u=new Set(a.map(c=>c.id)),r=n.filter(c=>!u.has(c.id)),p=W([...r],!1).slice(0,i);a=[...a,...p]}return W(a,!1)}else{const e=b.value,a=Math.min(Math.max(1,O.value),t-1),i=L.value;let u=0,r=0;i?(r=a,u=t-a):(u=a,r=t-a);const p=l.filter(h=>le(h,e)),c=l.filter(h=>!le(h,e)),T=n.filter(h=>le(h,e)),I=n.filter(h=>!le(h,e));let $=W([...p],!1).slice(0,u);if($.length<u){const h=u-$.length,U=new Set($.map(A=>A.id)),F=T.filter(A=>!U.has(A.id)),ne=W([...F],!1).slice(0,h);$=[...$,...ne]}let M=W([...c],!1).slice(0,r);if(M.length<r){const h=r-M.length,U=new Set(M.map(A=>A.id)),F=I.filter(A=>!U.has(A.id)),ne=W([...F],!1).slice(0,h);M=[...M,...ne]}if($.length<u||M.length<r)return alert(`卡池数量不足(含指定卡)。
需要符合卡：${u}张
需要干扰卡：${r}张`),[];const D=[...$,...M];return W(D,!1)}},Fe=(n,l,t,e,a,i)=>{const u=l.split("  ");let r="",p=e;for(let c=0;c<u.length;c++){const T=r+u[c]+"  ";n.measureText(T).width>a&&c>0?(n.fillText(r,t,p),r=u[c]+"  ",p+=i):r=T}return n.fillText(r,t,p),p+i},Ne=(n,l,t,e)=>{const a=l.split("  ");let i="",u=1;for(let r=0;r<a.length;r++){const p=i+a[r]+"  ";n.measureText(p).width>t&&r>0?(i=a[r]+"  ",u++):i=p}return u*e},Pe=async()=>{if(!j.value){j.value=!0,te.value=!1;try{const n=await Ie();if(n.length===0){j.value=!1,ie.value?alert("未找到符合条件的常用卡数据"):alert("未找到数据");return}const l=await Promise.all(n.map(async t=>{const e=t.text.types.includes("灵摆"),a=e?"!artp":"!art",i=`cdn.233.momobako.com/ygopro/pics/${t.id}.jpg${a}`,u=`https://wsrv.nl/?url=${encodeURIComponent(i)}&t=${new Date().getTime()}_${Math.random()}`;try{const r=await Je(u),p=le(t,b.value);return{img:r,isPendulum:e,answer:je(t),isMatchTarget:p,name:t.cn_name||t.jp_name||"未知卡名"}}catch(r){return console.warn(`Failed to load image for card ${t.id}`,r),null}}));setTimeout(()=>{te.value=!0,setTimeout(()=>{Se(fe.value,l,!1),Se(ve.value,l,!0),j.value=!1},50)},0)}catch(n){console.error(n),alert("生成过程中发生错误"),j.value=!1}}},Se=(n,l,t)=>{if(!n)return;const e=n.getContext("2d"),a=40,i=256,u=256,r=20,p=60,c="KaiTi",T=48,I=28,$=28,M=24;let D="",h="",U=0;if(_.value==="fill"){let d="";o.value==="race"?d="种族":o.value==="attribute"?d="属性":o.value==="category"?d="卡片种类":o.value==="subcategory"&&(d="细分种类"),D=`看游戏王卡图猜${d}`,h=pe.value.map((f,C)=>`${C+1}.${f}`).join("  ")}else{const d=O.value,f=L.value;let C="";d===1?C=f?"唯一一个非":"唯一一个":C=f?"所有非":"所有";let P="";o.value==="race"?P=`${b.value}族的怪兽`:o.value==="attribute"?P=`${b.value}属性的怪兽`:o.value==="category"?P=`${b.value}卡`:o.value==="subcategory"&&(P=`${b.value}卡`),D=`看游戏王卡图找出${C}${P}`,h=""}const F=100;e.font=`bold ${T}px ${c}`;const ne=e.measureText(D).width,A=i*w.value+r*(w.value-1),N=Math.max(800,A+a*2,ne+a*2),Te=N-a*2;if(_.value==="fill"){e.font=`${I}px ${c}`;const d=I+15,f=Ne(e,h,Te,d);let C=0;o.value==="subcategory"&&(C=40),U=f+C}else U=0,o.value==="subcategory"&&(U+=40);const Ce=a+F+U,he=Ce+Y.value*(u+p)+a;if(n.width=N,n.height=he,e.fillStyle="white",e.fillRect(0,0,N,he),e.fillStyle="black",e.font=`bold ${T}px ${c}`,e.textAlign="center",e.textBaseline="top",e.fillText(D,N/2,a),_.value==="fill"){e.font=`${I}px ${c}`,e.textAlign="left",e.textBaseline="alphabetic",e.fillStyle="#333";const d=Fe(e,h,a,a+F,Te,I+15);if(o.value==="subcategory"){e.fillStyle="#666",e.font=`20px ${c}`;const f="“通常怪兽”/“效果怪兽”是非额外非灵摆怪兽，“灵摆怪兽”是非额外怪兽。";e.fillText(f,a,d+10)}}else if(o.value==="subcategory"){e.fillStyle="#666",e.font=`20px ${c}`,e.textAlign="center",e.textBaseline="alphabetic";const d="“通常怪兽”/“效果怪兽”是非额外非灵摆怪兽，“灵摆怪兽”是非额外怪兽。";e.fillText(d,N/2,a+F)}const ze=w.value*i+(w.value-1)*r,Ge=(N-ze)/2;for(let d=0;d<l.length;d++){const f=l[d];if(!f)continue;const C=Math.floor(d/w.value),P=d%w.value,R=Ge+P*(i+r),E=Ce+C*(u+p);if(f.isPendulum?e.drawImage(f.img,R,E+20,256,216):e.drawImage(f.img,R,E,256,256),e.strokeStyle="#ddd",e.lineWidth=2,e.strokeRect(R,E,256,256),_.value==="fill"){e.font=`bold ${M}px ${c}`,e.fillStyle="#000",e.textAlign="left",e.textBaseline="alphabetic",e.fillText(`#${d+1}`,R+5,E+u+33);const S=R+i/2+13,V=E+u+33;if(e.font=`${$}px ${c}`,e.textAlign="center",t){const z=pe.value.indexOf(f.answer),G=z!==-1?`${z+1}.`:"";e.fillText(`( ${G}${f.answer} )`,S,V)}else e.fillText("(          )",S,V)}else{const S=R+i/2,V=E+u+33;if(e.font=`bold ${$}px ${c}`,e.textAlign="center",e.textBaseline="alphabetic",t){const z=L.value,G=f.isMatchTarget;(z?!G:G)?(e.save(),e.strokeStyle="#dc3545",e.lineWidth=6,e.strokeRect(R,E,256,256),e.restore(),e.fillStyle="#dc3545"):(e.save(),e.fillStyle="rgba(255, 255, 255, 0.65)",e.fillRect(R,E,256,256),e.restore(),e.fillStyle="#999"),e.fillText(f.answer,S,V),e.fillStyle="black"}else e.fillStyle="#000",e.fillText(`#${d+1}`,S,V)}if(t&&f.name){e.save();const S=24;e.font=`bold ${S}px ${c}`;let V=e.measureText(f.name).width;const z=i-10;let G=S;if(V>z){const me=z/V;G=Math.floor(S*me),e.font=`bold ${G}px ${c}`}const ue=S+16,Re=E+256-ue;let Me=.65;if(_.value==="judge"){const me=L.value,Ae=f.isMatchTarget;(me?!Ae:Ae)||(Me=.42)}e.fillStyle=`rgba(0, 0, 0, ${Me})`,e.fillRect(R,Re,i,ue),e.fillStyle="#fff",e.textAlign="center",e.textBaseline="middle",e.fillText(f.name,R+i/2,Re+ue/2),e.restore()}}e.fillStyle="#999",e.font=`14px ${c}`,e.textAlign="right",e.textBaseline="alphabetic",e.fillText("Created by Wanakachi",N-10,he-10)},ke=n=>{const l=n?ve.value:fe.value;if(!l)return;const t=l.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download=n?"游戏王卡图猜猜杯_答案.png":"游戏王卡图猜猜杯_题目.png",e.click()};return(n,l)=>(g(),x(de,null,[Ze,s("div",et,[s("div",tt,[lt,s("div",nt,[s("label",null,[m(s("input",{type:"radio","onUpdate:modelValue":l[0]||(l[0]=t=>_.value=t),value:"fill"},null,512),[[K,_.value]]),y(" 填空题")]),s("label",null,[m(s("input",{type:"radio","onUpdate:modelValue":l[1]||(l[1]=t=>_.value=t),value:"judge"},null,512),[[K,_.value]]),y(" 判断题")])])]),s("div",st,[at,s("div",it,[s("label",null,[m(s("input",{type:"radio","onUpdate:modelValue":l[2]||(l[2]=t=>o.value=t),value:"race"},null,512),[[K,o.value]]),y(" 种族")]),s("label",null,[m(s("input",{type:"radio","onUpdate:modelValue":l[3]||(l[3]=t=>o.value=t),value:"attribute"},null,512),[[K,o.value]]),y(" 属性")]),s("label",null,[m(s("input",{type:"radio","onUpdate:modelValue":l[4]||(l[4]=t=>o.value=t),value:"category"},null,512),[[K,o.value]]),y(" 卡片种类")]),s("label",null,[m(s("input",{type:"radio","onUpdate:modelValue":l[5]||(l[5]=t=>o.value=t),value:"subcategory"},null,512),[[K,o.value]]),y(" 细分种类")])])]),_.value==="judge"?(g(),x("div",ot,[rt,s("div",null,[ut,m(s("input",{type:"number","onUpdate:modelValue":l[6]||(l[6]=t=>O.value=t),min:"1",max:Y.value*w.value-1,class:"num-input",style:{width:"60px"}},null,8,ct),[[ce,O.value,void 0,{number:!0}]]),dt,m(s("select",{"onUpdate:modelValue":l[7]||(l[7]=t=>b.value=t),class:"select-input"},[(g(!0),x(de,null,be(pe.value,t=>(g(),x("option",{key:t,value:t},X(t),9,ft))),128))],512),[[Le,b.value]]),s("label",vt,[m(s("input",{type:"checkbox","onUpdate:modelValue":l[8]||(l[8]=t=>L.value=t)},null,512),[[ge,L.value]]),y(" 反选 (找“不是”的) ")])])])):q("",!0),s("div",pt,[ht,s("div",null,[m(s("input",{type:"number","onUpdate:modelValue":l[9]||(l[9]=t=>Y.value=t),min:"1",max:"10",class:"num-input"},null,512),[[ce,Y.value,void 0,{number:!0}]]),y(" 行 × "),m(s("input",{type:"number","onUpdate:modelValue":l[10]||(l[10]=t=>w.value=t),min:"1",max:"10",class:"num-input"},null,512),[[ce,w.value,void 0,{number:!0}]]),y(" 列 ")])]),s("div",mt,[bt,s("div",gt,[s("label",null,[m(s("input",{type:"checkbox","onUpdate:modelValue":l[11]||(l[11]=t=>ie.value=t)},null,512),[[ge,ie.value]]),y(" 只看常用卡")]),s("label",null,[m(s("input",{type:"checkbox","onUpdate:modelValue":l[12]||(l[12]=t=>Q.value=t)},null,512),[[ge,Q.value]]),y(" 指定卡片")]),Q.value?(g(),x("div",xt,[m(s("input",{type:"text","onUpdate:modelValue":l[13]||(l[13]=t=>oe.value=t),onKeyup:De($e,["enter"]),placeholder:"输入卡名搜索",class:"search-input"},null,544),[[ce,oe.value]]),s("button",{onClick:$e,disabled:Z.value,class:"btns small-btn"},X(Z.value?"...":"搜索"),9,yt),s("button",{onClick:We,disabled:k.value.length===0,class:"btns small-btn",style:{"background-color":"#dc3545","margin-left":"5px"}}," 清空 ",8,_t),ee.value&&J.value.length?(g(),x("div",wt,[(g(!0),x(de,null,be(J.value,t=>(g(),x("div",{key:t.id,class:"search-item",onClick:e=>Ue(t)},[s("span",St,X(t.cn_name||t.jp_name),1),s("span",kt,X(t.id),1)],8,$t))),128))])):q("",!0),ee.value&&J.value.length===0&&!Z.value?(g(),x("div",Tt,Rt)):q("",!0)])):q("",!0)])]),Q.value&&k.value.length>0?(g(),x("div",Mt,[(g(!0),x(de,null,be(k.value,(t,e)=>(g(),x("div",{key:t.id,class:"selected-card-tag"},[y(X(t.cn_name||t.jp_name)+" ",1),s("span",{class:"remove-btn",onClick:a=>Ve(e)},"×",8,At)]))),128))])):q("",!0),s("div",Et,[s("button",{onClick:Pe,disabled:j.value||re.value,class:"btns primary-btn"},X(re.value?"数据初始化...":j.value?"生成中...":"绘制图片"),9,Bt),s("button",{onClick:l[14]||(l[14]=t=>ke(!1)),disabled:!te.value,class:"btns download-btn"},"下载图片",8,Ut),s("button",{onClick:l[15]||(l[15]=t=>ke(!0)),disabled:!te.value,class:"btns download-btn"},"下载答案",8,Vt)])]),s("div",Wt,[te.value?(g(),x("canvas",{key:0,ref_key:"canvasVisible",ref:fe},null,512)):q("",!0),s("canvas",{ref_key:"canvasHidden",ref:ve,style:{display:"none"}},null,512)]),jt],64))}},Ht=He(It,[["__scopeId","data-v-78b9180b"]]);export{Ht as default};
