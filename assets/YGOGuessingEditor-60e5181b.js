import{_ as Ce,r as g,o as Re,a as le,c as se,b as n,e as y,j as A,h as m,f as oe,v as Be,t as Ae,i as We,F as Fe,p as Ue,g as Ie}from"./index-77b1bc84.js";import{F as Ve,l as Me,s as Ge}from"./utils-0b72f588.js";import"./_commonjsHelpers-de833af9.js";const k=E=>(Ue("data-v-b584c966"),E=E(),Ie(),E),He=k(()=>n("h1",null,"游戏王卡图猜猜杯制作器",-1)),je={id:"input-container"},Pe={id:"modes-settings"},Ye=k(()=>n("span",{id:"matching-hint"},"主题选择: ",-1)),Oe={class:"radio-group"},ze={id:"modes-settings"},Ne=k(()=>n("span",{id:"matching-hint"},"矩阵大小: ",-1)),Le={id:"modes-settings"},De=k(()=>n("span",{id:"matching-hint"},"筛选设置: ",-1)),Xe={id:"button-container"},Ke=["disabled"],qe=["disabled"],Je=["disabled"],Qe={id:"canvas-container"},Ze=k(()=>n("div",{id:"notice"},[n("p",null,"注意：数据更新至 2025.12.11。"),n("p",null,[m("卡图及卡片数据来源： "),n("a",{href:"https://ygocdb.com"},"百鸽")]),n("p",null,[m("常用卡统计来源： "),n("a",{href:"https://mycard.world/ygopro/arena/index.html"},"MCPro 决斗数据库")]),n("p",null,[m("种族/属性/种类信息摘自： "),n("a",{href:"https://zh.wikipedia.org/wiki/%E9%81%8A%E6%88%B2%E7%8E%8B%E9%9B%86%E6%8F%9B%E7%B4%99%E7%89%8C%E9%81%8A%E6%88%B2"},"游戏王中文维基")])],-1)),et={__name:"YGOGuessingEditor",setup(E){const W=["龙","魔法师","不死","战士","兽战士","兽","鸟兽","恶魔","天使","昆虫","恐龙","爬虫类","鱼","海龙","机械","雷","水","炎","岩石","植物","念动力","幻龙","电子界","幻想魔","幻神兽","创造神"],F=["暗","光","地","水","炎","风","神"],ie=["怪兽","魔法","陷阱"],ae=["通常怪兽","效果怪兽","仪式怪兽","融合怪兽","同调怪兽","超量怪兽","灵摆怪兽","连接怪兽","通常魔法","仪式魔法","速攻魔法","永续魔法","装备魔法","场地魔法","通常陷阱","永续陷阱","反击陷阱"],u=g("race"),C=g(3),v=g(4),R=g(!1),x=g(!1),B=g(!0),$=g(!1),U=g(null),I=g(null);let z=[],V=[],N=new Set;const re=new Ve("KaiTi");Re(async()=>{const i=re.check(),t=fetch("cards/cards.json").then(s=>s.json()).then(s=>{const e=s.default||s,a=Object.values(e);V=a,z=a.filter(o=>o.text&&o.text.types&&o.text.types.includes("怪兽")),a.filter(o=>o.text&&o.text.types&&o.text.types.includes("魔法")),a.filter(o=>o.text&&o.text.types&&o.text.types.includes("陷阱"))}),l=fetch("cards/common_cards.json").then(s=>s.json()).then(s=>{const e=s.default||s;N=new Set(e.map(a=>Number(a)))}).catch(s=>{console.warn("常用卡数据加载失败",s)});try{await Promise.all([i,t,l]),B.value=!1}catch(s){console.error("初始化失败",s),alert("数据加载发生错误，请刷新重试")}});const ue=i=>{if(!i||!i.text||!i.text.types)return"未知";const t=i.text.types;if(u.value==="category")return t.includes("魔法")?"魔法":t.includes("陷阱")?"陷阱":t.includes("怪兽")?"怪兽":"未知";if(u.value==="subcategory")return t.includes("魔法")?t.includes("仪式")?"仪式魔法":t.includes("速攻")?"速攻魔法":t.includes("永续")?"永续魔法":t.includes("装备")?"装备魔法":t.includes("场地")?"场地魔法":"通常魔法":t.includes("陷阱")?t.includes("永续")?"永续陷阱":t.includes("反击")?"反击陷阱":"通常陷阱":t.includes("仪式")?"仪式怪兽":t.includes("融合")?"融合怪兽":t.includes("同调")?"同调怪兽":t.includes("超量")?"超量怪兽":t.includes("连接")?"连接怪兽":t.includes("灵摆")?"灵摆怪兽":t.includes("通常")?"通常怪兽":"效果怪兽";const l=/](.*?)\/(.*?)(\n|$)/,s=t.match(l);if(s){const e=s[1].trim(),a=s[2].trim();if(u.value==="race")return W.find(r=>e===r||e.includes(r))||"未知";if(u.value==="attribute")return F.find(r=>a===r||a.includes(r))||"未知"}return u.value==="attribute"?F.find(a=>t.includes("/"+a)||t.includes("/ "+a))||"未知":[...W].sort((o,r)=>r.length-o.length).find(o=>t.includes(o))||"未知"},ce=async()=>{if(B.value)return alert("数据正在初始化，请稍后再试..."),[];let i=[];return u.value==="category"||u.value==="subcategory"?i=V:i=z,R.value&&(i=i.filter(l=>N.has(Number(l.id)))),Ge([...i],!1).slice(0,C.value*v.value)},de=(i,t,l,s,e,a)=>{const o=t.split("  ");let r="",c=s;for(let h=0;h<o.length;h++){const d=r+o[h]+"  ";i.measureText(d).width>e&&h>0?(i.fillText(r,l,c),r=o[h]+"  ",c+=a):r=d}return i.fillText(r,l,c),c+a},fe=(i,t,l,s)=>{const e=t.split("  ");let a="",o=1;for(let r=0;r<e.length;r++){const c=a+e[r]+"  ";i.measureText(c).width>l&&r>0?(a=e[r]+"  ",o++):a=c}return o*s},pe=async()=>{if(!x.value){x.value=!0,$.value=!1;try{const i=await ce();if(i.length===0){x.value=!1,R.value?alert("未找到符合条件的常用卡数据"):alert("未找到数据");return}let t=[];u.value==="race"?t=W:u.value==="attribute"?t=F:u.value==="category"?t=ie:u.value==="subcategory"&&(t=ae);const l=await Promise.all(i.map(async s=>{const e=s.text.types.includes("灵摆"),a=e?"!artp":"!art",o=`cdn.233.momobako.com/ygopro/pics/${s.id}.jpg${a}`,r=`https://wsrv.nl/?url=${encodeURIComponent(o)}&t=${new Date().getTime()}_${Math.random()}`;try{return{img:await Me(r),isPendulum:e,answer:ue(s),name:s.cn_name||s.jp_name||"未知卡名"}}catch(c){return console.warn(`Failed to load image for card ${s.id}`,c),null}}));setTimeout(()=>{$.value=!0,setTimeout(()=>{L(U.value,l,t,!1),L(I.value,l,t,!0),x.value=!1},50)},0)}catch(i){console.error(i),alert("生成过程中发生错误"),x.value=!1}}},L=(i,t,l,s)=>{if(!i)return;const e=i.getContext("2d"),a=40,o=256,r=256,c=20,h=60,d="KaiTi",X=48,T=28,me=28,ve=24;let S="";u.value==="race"?S="种族":u.value==="attribute"?S="属性":u.value==="category"?S="卡片种类":u.value==="subcategory"&&(S="细分种类");const he=`看游戏王卡图猜${S}`,K=100,q=l.map((p,f)=>`${f+1}.${p}`).join("  "),ge=o*v.value+c*(v.value-1),_=Math.max(800,ge+a*2),J=_-a*2;e.font=`${T}px ${d}`;const xe=T+15,be=fe(e,q,J,xe);let Q=0;u.value==="subcategory"&&(Q=40);const ye=be+20+Q,Z=a+K+ye,M=Z+C.value*(r+h)+a;i.width=_,i.height=M,e.fillStyle="white",e.fillRect(0,0,_,M),e.fillStyle="black",e.font=`bold ${X}px ${d}`,e.textAlign="center",e.textBaseline="top",e.fillText(he,_/2,a),e.font=`${T}px ${d}`,e.textAlign="left",e.textBaseline="alphabetic",e.fillStyle="#333";const _e=de(e,q,a,a+K,J,T+15);if(u.value==="subcategory"){e.fillStyle="#666",e.font=`20px ${d}`;const p="“通常怪兽”/“效果怪兽”是非额外非灵摆怪兽，“灵摆怪兽”是非额外怪兽。";e.fillText(p,a,_e+10)}const we=v.value*o+(v.value-1)*c,$e=(_-we)/2;for(let p=0;p<t.length;p++){const f=t[p];if(!f)continue;const Te=Math.floor(p/v.value),Se=p%v.value,b=$e+Se*(o+c),w=Z+Te*(r+h);f.isPendulum?e.drawImage(f.img,b,w+20,256,216):e.drawImage(f.img,b,w,256,256),e.strokeStyle="#ddd",e.lineWidth=2,e.strokeRect(b,w,256,256),e.font=`bold ${ve}px ${d}`,e.fillStyle="#000",e.textAlign="left",e.textBaseline="alphabetic",e.fillText(`#${p+1}`,b+5,w+r+33);const ee=b+o/2+13,te=w+r+33;if(e.font=`${me}px ${d}`,e.textAlign="center",s){const G=l.indexOf(f.answer),ke=G!==-1?`${G+1}.`:"";if(e.fillText(`( ${ke}${f.answer} )`,ee,te),f.name){e.save();const H=24;e.font=`bold ${H}px ${d}`;let j=e.measureText(f.name).width;const P=o-10;let Y=H;if(j>P){const Ee=P/j;Y=Math.floor(H*Ee),e.font=`bold ${Y}px ${d}`,j=P}const O=Y+14,ne=w+256-O;e.fillStyle="rgba(0, 0, 0, 0.65)",e.fillRect(b,ne,o,O),e.fillStyle="#fff",e.textAlign="center",e.textBaseline="middle",e.fillText(f.name,b+o/2,ne+O/2),e.restore()}}else e.fillText("(          )",ee,te)}e.fillStyle="#999",e.font=`14px ${d}`,e.textAlign="right",e.textBaseline="alphabetic",e.fillText("Created by Wanakachi",_-10,M-18)},D=i=>{const t=i?I.value:U.value;if(!t)return;const l=t.toDataURL("image/png"),s=document.createElement("a");s.href=l,s.download=i?"游戏王卡图猜猜杯_答案.png":"游戏王卡图猜猜杯_题目.png",s.click()};return(i,t)=>(le(),se(Fe,null,[He,n("div",je,[n("div",Pe,[Ye,n("div",Oe,[n("label",null,[y(n("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=l=>u.value=l),value:"race"},null,512),[[A,u.value]]),m(" 种族")]),n("label",null,[y(n("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=l=>u.value=l),value:"attribute"},null,512),[[A,u.value]]),m(" 属性")]),n("label",null,[y(n("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=l=>u.value=l),value:"category"},null,512),[[A,u.value]]),m(" 卡片种类")]),n("label",null,[y(n("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=l=>u.value=l),value:"subcategory"},null,512),[[A,u.value]]),m(" 细分种类")])])]),n("div",ze,[Ne,n("div",null,[y(n("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=l=>C.value=l),min:"1",max:"10",class:"num-input"},null,512),[[oe,C.value,void 0,{number:!0}]]),m(" 行 × "),y(n("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=l=>v.value=l),min:"1",max:"10",class:"num-input"},null,512),[[oe,v.value,void 0,{number:!0}]]),m(" 列 ")])]),n("div",Le,[De,n("div",null,[n("label",null,[y(n("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=l=>R.value=l)},null,512),[[Be,R.value]]),m(" 只看常用卡")])])]),n("div",Xe,[n("button",{onClick:pe,disabled:x.value||B.value,class:"btns primary-btn"},Ae(B.value?"数据初始化...":x.value?"生成中...":"绘制图片"),9,Ke),n("button",{onClick:t[7]||(t[7]=l=>D(!1)),disabled:!$.value,class:"btns download-btn"},"下载图片",8,qe),n("button",{onClick:t[8]||(t[8]=l=>D(!0)),disabled:!$.value,class:"btns download-btn"},"下载答案",8,Je)])]),n("div",Qe,[$.value?(le(),se("canvas",{key:0,ref_key:"canvasVisible",ref:U},null,512)):We("",!0),n("canvas",{ref_key:"canvasHidden",ref:I,style:{display:"none"}},null,512)]),Ze],64))}},ot=Ce(et,[["__scopeId","data-v-b584c966"]]);export{ot as default};
