import{_ as Ce,r as h,o as Re,a as ae,c as le,b as i,e as b,j as A,h as y,f as se,v as Ae,t as Be,i as We,F as Fe,k as Me,p as Ue,g as Ve}from"./index-68a7fc2c.js";import{F as Ie,l as Ge,s as He}from"./utils-0b72f588.js";import"./_commonjsHelpers-de833af9.js";const B=k=>(Ue("data-v-eaf7fa3d"),k=k(),Ve(),k),je=B(()=>i("h1",null,"游戏王卡图猜猜杯制作器",-1)),Pe={id:"input-container"},Ye={id:"modes-settings"},Ne=B(()=>i("span",{id:"matching-hint"},"主题选择: ",-1)),Oe={class:"radio-group"},ze={id:"modes-settings"},De=B(()=>i("span",{id:"matching-hint"},"矩阵大小: ",-1)),Le={id:"modes-settings"},Xe=B(()=>i("span",{id:"matching-hint"},"筛选设置: ",-1)),Ke={id:"button-container"},qe=["disabled"],Je=["disabled"],Qe=["disabled"],Ze={id:"canvas-container"},et=Me('<div id="notice" data-v-eaf7fa3d><p data-v-eaf7fa3d>卡图及卡片数据来源： <a href="https://ygocdb.com" data-v-eaf7fa3d>百鸽</a></p><p data-v-eaf7fa3d>常用卡统计来源： <a href="https://mycard.world/ygopro/arena/index.html" data-v-eaf7fa3d>MCPro 决斗数据库</a></p><p data-v-eaf7fa3d>种族/属性/种类信息摘自： <a href="https://zh.wikipedia.org/wiki/%E9%81%8A%E6%88%B2%E7%8E%8B%E9%9B%86%E6%8F%9B%E7%B4%99%E7%89%8C%E9%81%8A%E6%88%B2" data-v-eaf7fa3d>游戏王中文维基</a></p><p data-v-eaf7fa3d>注意：数据更新有延迟。请查看 <a href="https://github.com/WatanabeChika/Wana_tools/blob/main/README.md" data-v-eaf7fa3d> README </a> 获取最近更新时间。 </p></div>',1),tt={__name:"YGOGuessingEditor",setup(k){const W=["龙","魔法师","不死","战士","兽战士","兽","鸟兽","恶魔","天使","昆虫","恐龙","爬虫类","鱼","海龙","机械","雷","水","炎","岩石","植物","念动力","幻龙","电子界","幻想魔","幻神兽","创造神"],F=["暗","光","地","水","炎","风","神"],oe=["怪兽","魔法","陷阱"],ie=["通常怪兽","效果怪兽","仪式怪兽","融合怪兽","同调怪兽","超量怪兽","灵摆怪兽","连接怪兽","通常魔法","仪式魔法","速攻魔法","永续魔法","装备魔法","场地魔法","通常陷阱","永续陷阱","反击陷阱"],d=h("race"),E=h(3),m=h(4),C=h(!1),g=h(!1),R=h(!0),$=h(!1),M=h(null),U=h(null);let O=[],V=[],z=new Set;const re=new Ie("KaiTi");Re(async()=>{const s=re.check(),t=fetch("cards/cards.json").then(a=>a.json()).then(a=>{const e=a.default||a,o=Object.values(e);V=o,O=o.filter(l=>l.text&&l.text.types&&l.text.types.includes("怪兽")),o.filter(l=>l.text&&l.text.types&&l.text.types.includes("魔法")),o.filter(l=>l.text&&l.text.types&&l.text.types.includes("陷阱"))}),n=fetch("cards/common_cards.json").then(a=>a.json()).then(a=>{const e=a.default||a;z=new Set(e.map(o=>Number(o)))}).catch(a=>{console.warn("常用卡数据加载失败",a)});try{await Promise.all([s,t,n]),R.value=!1}catch(a){console.error("初始化失败",a),alert("数据加载发生错误，请刷新重试")}});const de=s=>{if(!s||!s.text||!s.text.types)return"未知";const t=s.text.types;if(d.value==="category")return t.includes("魔法")?"魔法":t.includes("陷阱")?"陷阱":t.includes("怪兽")?"怪兽":"未知";if(d.value==="subcategory")return t.includes("魔法")?t.includes("仪式")?"仪式魔法":t.includes("速攻")?"速攻魔法":t.includes("永续")?"永续魔法":t.includes("装备")?"装备魔法":t.includes("场地")?"场地魔法":"通常魔法":t.includes("陷阱")?t.includes("永续")?"永续陷阱":t.includes("反击")?"反击陷阱":"通常陷阱":t.includes("仪式")?"仪式怪兽":t.includes("融合")?"融合怪兽":t.includes("同调")?"同调怪兽":t.includes("超量")?"超量怪兽":t.includes("连接")?"连接怪兽":t.includes("灵摆")?"灵摆怪兽":t.includes("通常")?"通常怪兽":"效果怪兽";const n=/](.*?)\/(.*?)(\n|$)/,a=t.match(n);if(a){const e=a[1].trim(),o=a[2].trim();if(d.value==="race")return W.find(r=>e===r||e.includes(r))||"未知";if(d.value==="attribute")return F.find(r=>o===r||o.includes(r))||"未知"}return d.value==="attribute"?F.find(o=>t.includes("/"+o)||t.includes("/ "+o))||"未知":[...W].sort((l,r)=>r.length-l.length).find(l=>t.includes(l))||"未知"},ue=async()=>{if(R.value)return alert("数据正在初始化，请稍后再试..."),[];let s=[];return d.value==="category"||d.value==="subcategory"?s=V:s=O,C.value&&(s=s.filter(n=>z.has(Number(n.id)))),He([...s],!1).slice(0,E.value*m.value)},ce=(s,t,n,a,e,o)=>{const l=t.split("  ");let r="",u=a;for(let v=0;v<l.length;v++){const c=r+l[v]+"  ";s.measureText(c).width>e&&v>0?(s.fillText(r,n,u),r=l[v]+"  ",u+=o):r=c}return s.fillText(r,n,u),u+o},fe=(s,t,n,a)=>{const e=t.split("  ");let o="",l=1;for(let r=0;r<e.length;r++){const u=o+e[r]+"  ";s.measureText(u).width>n&&r>0?(o=e[r]+"  ",l++):o=u}return l*a},pe=async()=>{if(!g.value){g.value=!0,$.value=!1;try{const s=await ue();if(s.length===0){g.value=!1,C.value?alert("未找到符合条件的常用卡数据"):alert("未找到数据");return}let t=[];d.value==="race"?t=W:d.value==="attribute"?t=F:d.value==="category"?t=oe:d.value==="subcategory"&&(t=ie);const n=await Promise.all(s.map(async a=>{const e=a.text.types.includes("灵摆"),o=e?"!artp":"!art",l=`cdn.233.momobako.com/ygopro/pics/${a.id}.jpg${o}`,r=`https://wsrv.nl/?url=${encodeURIComponent(l)}&t=${new Date().getTime()}_${Math.random()}`;try{return{img:await Ge(r),isPendulum:e,answer:de(a),name:a.cn_name||a.jp_name||"未知卡名"}}catch(u){return console.warn(`Failed to load image for card ${a.id}`,u),null}}));setTimeout(()=>{$.value=!0,setTimeout(()=>{D(M.value,n,t,!1),D(U.value,n,t,!0),g.value=!1},50)},0)}catch(s){console.error(s),alert("生成过程中发生错误"),g.value=!1}}},D=(s,t,n,a)=>{if(!s)return;const e=s.getContext("2d"),o=40,l=256,r=256,u=20,v=60,c="KaiTi",X=48,S=28,me=28,ve=24;let T="";d.value==="race"?T="种族":d.value==="attribute"?T="属性":d.value==="category"?T="卡片种类":d.value==="subcategory"&&(T="细分种类");const he=`看游戏王卡图猜${T}`,K=100,q=n.map((p,f)=>`${f+1}.${p}`).join("  "),ge=l*m.value+u*(m.value-1),_=Math.max(800,ge+o*2),J=_-o*2;e.font=`${S}px ${c}`;const xe=S+15,be=fe(e,q,J,xe);let Q=0;d.value==="subcategory"&&(Q=40);const ye=be+20+Q,Z=o+K+ye,I=Z+E.value*(r+v)+o;s.width=_,s.height=I,e.fillStyle="white",e.fillRect(0,0,_,I),e.fillStyle="black",e.font=`bold ${X}px ${c}`,e.textAlign="center",e.textBaseline="top",e.fillText(he,_/2,o),e.font=`${S}px ${c}`,e.textAlign="left",e.textBaseline="alphabetic",e.fillStyle="#333";const _e=ce(e,q,o,o+K,J,S+15);if(d.value==="subcategory"){e.fillStyle="#666",e.font=`20px ${c}`;const p="“通常怪兽”/“效果怪兽”是非额外非灵摆怪兽，“灵摆怪兽”是非额外怪兽。";e.fillText(p,o,_e+10)}const we=m.value*l+(m.value-1)*u,$e=(_-we)/2;for(let p=0;p<t.length;p++){const f=t[p];if(!f)continue;const Se=Math.floor(p/m.value),Te=p%m.value,x=$e+Te*(l+u),w=Z+Se*(r+v);f.isPendulum?e.drawImage(f.img,x,w+20,256,216):e.drawImage(f.img,x,w,256,256),e.strokeStyle="#ddd",e.lineWidth=2,e.strokeRect(x,w,256,256),e.font=`bold ${ve}px ${c}`,e.fillStyle="#000",e.textAlign="left",e.textBaseline="alphabetic",e.fillText(`#${p+1}`,x+5,w+r+33);const ee=x+l/2+13,te=w+r+33;if(e.font=`${me}px ${c}`,e.textAlign="center",a){const G=n.indexOf(f.answer),ke=G!==-1?`${G+1}.`:"";if(e.fillText(`( ${ke}${f.answer} )`,ee,te),f.name){e.save();const H=24;e.font=`bold ${H}px ${c}`;let j=e.measureText(f.name).width;const P=l-10;let Y=H;if(j>P){const Ee=P/j;Y=Math.floor(H*Ee),e.font=`bold ${Y}px ${c}`,j=P}const N=Y+14,ne=w+256-N;e.fillStyle="rgba(0, 0, 0, 0.65)",e.fillRect(x,ne,l,N),e.fillStyle="#fff",e.textAlign="center",e.textBaseline="middle",e.fillText(f.name,x+l/2,ne+N/2),e.restore()}}else e.fillText("(          )",ee,te)}e.fillStyle="#999",e.font=`14px ${c}`,e.textAlign="right",e.textBaseline="alphabetic",e.fillText("Created by Wanakachi",_-10,I-10)},L=s=>{const t=s?U.value:M.value;if(!t)return;const n=t.toDataURL("image/png"),a=document.createElement("a");a.href=n,a.download=s?"游戏王卡图猜猜杯_答案.png":"游戏王卡图猜猜杯_题目.png",a.click()};return(s,t)=>(ae(),le(Fe,null,[je,i("div",Pe,[i("div",Ye,[Ne,i("div",Oe,[i("label",null,[b(i("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=n=>d.value=n),value:"race"},null,512),[[A,d.value]]),y(" 种族")]),i("label",null,[b(i("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=n=>d.value=n),value:"attribute"},null,512),[[A,d.value]]),y(" 属性")]),i("label",null,[b(i("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=n=>d.value=n),value:"category"},null,512),[[A,d.value]]),y(" 卡片种类")]),i("label",null,[b(i("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=n=>d.value=n),value:"subcategory"},null,512),[[A,d.value]]),y(" 细分种类")])])]),i("div",ze,[De,i("div",null,[b(i("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=n=>E.value=n),min:"1",max:"10",class:"num-input"},null,512),[[se,E.value,void 0,{number:!0}]]),y(" 行 × "),b(i("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=n=>m.value=n),min:"1",max:"10",class:"num-input"},null,512),[[se,m.value,void 0,{number:!0}]]),y(" 列 ")])]),i("div",Le,[Xe,i("div",null,[i("label",null,[b(i("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=n=>C.value=n)},null,512),[[Ae,C.value]]),y(" 只看常用卡")])])]),i("div",Ke,[i("button",{onClick:pe,disabled:g.value||R.value,class:"btns primary-btn"},Be(R.value?"数据初始化...":g.value?"生成中...":"绘制图片"),9,qe),i("button",{onClick:t[7]||(t[7]=n=>L(!1)),disabled:!$.value,class:"btns download-btn"},"下载图片",8,Je),i("button",{onClick:t[8]||(t[8]=n=>L(!0)),disabled:!$.value,class:"btns download-btn"},"下载答案",8,Qe)])]),i("div",Ze,[$.value?(ae(),le("canvas",{key:0,ref_key:"canvasVisible",ref:M},null,512)):We("",!0),i("canvas",{ref_key:"canvasHidden",ref:U,style:{display:"none"}},null,512)]),et],64))}},ot=Ce(tt,[["__scopeId","data-v-eaf7fa3d"]]);export{ot as default};
