import{_ as Be,r as m,w as he,j as We,o as Ue,a as z,c as G,b as s,e as g,k as F,h as $,f as se,l as Ve,F as ge,d as je,t as xe,v as be,i as ye,m as Fe,p as Ie,g as Ne}from"./index-bae29952.js";import{F as ze,l as Ge,s as q}from"./utils-0b72f588.js";import"./_commonjsHelpers-de833af9.js";const E=H=>(Ie("data-v-381332b6"),H=H(),Ne(),H),He=E(()=>s("h1",null,"游戏王卡图猜猜杯制作器",-1)),Ye={id:"input-container"},Oe={id:"modes-settings"},Pe=E(()=>s("span",{id:"matching-hint"},"题目形式: ",-1)),Le={class:"radio-group"},De={id:"modes-settings"},Xe=E(()=>s("span",{id:"matching-hint"},"主题选择: ",-1)),Ke={class:"radio-group"},qe={key:0,id:"modes-settings"},Qe=E(()=>s("span",{id:"matching-hint"},"判断配置: ",-1)),Je=E(()=>s("span",{style:{"font-size":"14px",margin:"0 5px"}},"找出",-1)),Ze=["max"],et=E(()=>s("span",{style:{"font-size":"14px",margin:"0 5px 10px 5px"}},"个",-1)),tt=["value"],nt={style:{"margin-left":"10px","font-weight":"normal"}},lt={id:"modes-settings"},st=E(()=>s("span",{id:"matching-hint"},"矩阵大小: ",-1)),it={id:"modes-settings"},at=E(()=>s("span",{id:"matching-hint"},"筛选设置: ",-1)),ot={id:"button-container"},ut=["disabled"],rt=["disabled"],ct=["disabled"],dt={id:"canvas-container"},ft=Fe('<div id="notice" data-v-381332b6><p data-v-381332b6>卡图及卡片数据来源： <a href="https://ygocdb.com" data-v-381332b6>百鸽</a></p><p data-v-381332b6>常用卡统计来源： <a href="https://mycard.world/ygopro/arena/index.html" data-v-381332b6>MCPro 决斗数据库</a></p><p data-v-381332b6>种族/属性/种类信息摘自： <a href="https://zh.wikipedia.org/wiki/%E9%81%8A%E6%88%B2%E7%8E%8B%E9%9B%86%E6%8F%9B%E7%B4%99%E7%89%8C%E9%81%8A%E6%88%B2" data-v-381332b6>游戏王中文维基</a></p><p data-v-381332b6>注意：数据更新有延迟。请查看 <a href="https://github.com/WatanabeChika/Wana_tools/blob/main/README.md" data-v-381332b6> README </a> 获取最近更新时间。 </p></div>',1),vt={__name:"YGOGuessingEditor",setup(H){const I=["龙","魔法师","不死","战士","兽战士","兽","鸟兽","恶魔","天使","昆虫","恐龙","爬虫类","鱼","海龙","机械","雷","水","炎","岩石","植物","念动力","幻龙","电子界","幻想魔","幻神兽","创造神"],Y=["暗","光","地","水","炎","风","神"],ie=["怪兽","魔法","陷阱"],ae=["通常怪兽","效果怪兽","仪式怪兽","融合怪兽","同调怪兽","超量怪兽","灵摆怪兽","连接怪兽","通常魔法","仪式魔法","速攻魔法","永续魔法","装备魔法","场地魔法","通常陷阱","永续陷阱","反击陷阱"],x=m("fill"),o=m("race"),R=m(3),h=m(4),O=m(!1),p=m(""),V=m(1),j=m(!1),M=m(!1),P=m(!0),N=m(!1),Q=m(null),J=m(null);let oe=[],ue=new Set;he(o,l=>{l==="race"?p.value=I[0]:l==="attribute"?p.value=Y[0]:l==="category"?p.value=ie[0]:l==="subcategory"&&(p.value=ae[0])}),he([R,h],([l,n])=>{const t=l*n-1;V.value>t&&(V.value=Math.max(1,t))});const Z=We(()=>o.value==="race"?I:o.value==="attribute"?Y:o.value==="category"?ie:o.value==="subcategory"?ae:[]),_e=new ze("KaiTi");Ue(async()=>{const l=_e.check(),n=fetch("cards/cards.json").then(e=>e.json()).then(e=>{const a=e.default||e;oe=Object.values(a)}),t=fetch("cards/common_cards.json").then(e=>e.json()).then(e=>{const a=e.default||e;ue=new Set(a.map(i=>Number(i)))}).catch(()=>null);try{await Promise.all([l,n,t]),p.value=I[0],P.value=!1}catch(e){console.error("初始化失败",e),alert("数据加载发生错误，请刷新重试")}});const ee=(l,n)=>{if(!l||!l.text||!l.text.types)return!1;const t=l.text.types,e=o.value;if(e==="category"){if(n==="怪兽")return t.includes("怪兽");if(n==="魔法")return t.includes("魔法");if(n==="陷阱")return t.includes("陷阱")}else if(e==="subcategory"){if(n==="通常怪兽")return t.includes("通常")&&t.includes("怪兽");if(n==="效果怪兽")return!t.includes("通常")&&t.includes("怪兽")&&!t.includes("仪式")&&!t.includes("融合")&&!t.includes("同调")&&!t.includes("超量")&&!t.includes("连接")&&!t.includes("灵摆");const a=n.replace("怪兽","").replace("魔法","").replace("陷阱","");return n==="通常魔法"?t.includes("魔法")&&!["仪式","速攻","永续","装备","场地"].some(i=>t.includes(i)):n==="通常陷阱"?t.includes("陷阱")&&!["永续","反击"].some(i=>t.includes(i)):t.includes(a)}else if(e==="race"){const a=/](.*?)\/(.*?)(\n|$)/,i=t.match(a);return i?i[1].includes(n):t.includes(n)}else if(e==="attribute"){const a=/](.*?)\/(.*?)(\n|$)/,i=t.match(a);return i?i[2].includes(n):t.includes(n)}return!1},$e=l=>{if(!l||!l.text||!l.text.types)return"未知";const n=l.text.types;if(o.value==="category")return n.includes("魔法")?"魔法":n.includes("陷阱")?"陷阱":n.includes("怪兽")?"怪兽":"未知";if(o.value==="subcategory")return n.includes("魔法")?n.includes("仪式")?"仪式魔法":n.includes("速攻")?"速攻魔法":n.includes("永续")?"永续魔法":n.includes("装备")?"装备魔法":n.includes("场地")?"场地魔法":"通常魔法":n.includes("陷阱")?n.includes("永续")?"永续陷阱":n.includes("反击")?"反击陷阱":"通常陷阱":n.includes("仪式")?"仪式怪兽":n.includes("融合")?"融合怪兽":n.includes("同调")?"同调怪兽":n.includes("超量")?"超量怪兽":n.includes("连接")?"连接怪兽":n.includes("灵摆")?"灵摆怪兽":n.includes("通常")?"通常怪兽":"效果怪兽";const t=/](.*?)\/(.*?)(\n|$)/,e=n.match(t);if(e){const a=e[1].trim(),i=e[2].trim();if(o.value==="race")return I.find(u=>a===u||a.includes(u))||"未知";if(o.value==="attribute")return Y.find(u=>i===u||i.includes(u))||"未知"}return o.value==="attribute"?Y.find(i=>n.includes("/"+i)||n.includes("/ "+i))||"未知":[...I].sort((r,u)=>u.length-r.length).find(r=>n.includes(r))||"未知"},Te=async()=>{if(P.value)return alert("数据正在初始化，请稍后再试..."),[];let l=oe;(o.value==="race"||o.value==="attribute")&&(l=l.filter(t=>t.text&&t.text.types&&t.text.types.includes("怪兽"))),O.value&&(l=l.filter(t=>ue.has(Number(t.id))));const n=R.value*h.value;if(x.value==="fill")return q([...l],!1).slice(0,R.value*h.value);{const t=p.value,e=Math.min(Math.max(1,V.value),n-1),a=j.value,i=l.filter(B=>ee(B,t)),r=l.filter(B=>!ee(B,t));let u=0,v=0;if(a?(v=e,u=n-e):(u=e,v=n-e),i.length<u||r.length<v)return alert(`卡池数量不足。
需要符合卡：${u}张 (现有${i.length})
需要干扰卡：${v}张 (现有${r.length})`),[];const c=q([...i],!1),w=q([...r],!1),A=[...c.slice(0,u),...w.slice(0,v)];return q(A,!1)}},Se=(l,n,t,e,a,i)=>{const r=n.split("  ");let u="",v=e;for(let c=0;c<r.length;c++){const w=u+r[c]+"  ";l.measureText(w).width>a&&c>0?(l.fillText(u,t,v),u=r[c]+"  ",v+=i):u=w}return l.fillText(u,t,v),v+i},we=(l,n,t,e)=>{const a=n.split("  ");let i="",r=1;for(let u=0;u<a.length;u++){const v=i+a[u]+"  ";l.measureText(v).width>t&&u>0?(i=a[u]+"  ",r++):i=v}return r*e},ke=async()=>{if(!M.value){M.value=!0,N.value=!1;try{const l=await Te();if(l.length===0){M.value=!1,O.value?alert("未找到符合条件的常用卡数据"):alert("未找到数据");return}const n=await Promise.all(l.map(async t=>{const e=t.text.types.includes("灵摆"),a=e?"!artp":"!art",i=`cdn.233.momobako.com/ygopro/pics/${t.id}.jpg${a}`,r=`https://wsrv.nl/?url=${encodeURIComponent(i)}&t=${new Date().getTime()}_${Math.random()}`;try{const u=await Ge(r),v=ee(t,p.value);return{img:u,isPendulum:e,answer:$e(t),isMatchTarget:v,name:t.cn_name||t.jp_name||"未知卡名"}}catch(u){return console.warn(`Failed to load image for card ${t.id}`,u),null}}));setTimeout(()=>{N.value=!0,setTimeout(()=>{re(Q.value,n,!1),re(J.value,n,!0),M.value=!1},50)},0)}catch(l){console.error(l),alert("生成过程中发生错误"),M.value=!1}}},re=(l,n,t)=>{if(!l)return;const e=l.getContext("2d"),a=40,i=256,r=256,u=20,v=60,c="KaiTi",w=48,A=28,B=28,Ce=24;let L="",D="",X=0;if(x.value==="fill"){let d="";o.value==="race"?d="种族":o.value==="attribute"?d="属性":o.value==="category"?d="卡片种类":o.value==="subcategory"&&(d="细分种类"),L=`看游戏王卡图猜${d}`,D=Z.value.map((f,b)=>`${b+1}.${f}`).join("  ")}else{const d=V.value,f=j.value;let b="";d===1?b=f?"唯一一个非":"唯一一个":b=f?"所有非":"所有";let U="";o.value==="race"?U=`${p.value}族的怪兽`:o.value==="attribute"?U=`${p.value}属性的怪兽`:o.value==="category"?U=`${p.value}卡`:o.value==="subcategory"&&(U=`${p.value}卡`),L=`看游戏王卡图找出${b}${U}`,D=""}const te=100;e.font=`bold ${w}px ${c}`;const Ee=e.measureText(L).width,Re=i*h.value+u*(h.value-1),W=Math.max(800,Re+a*2,Ee+a*2),de=W-a*2;if(x.value==="fill"){e.font=`${A}px ${c}`;const d=A+15,f=we(e,D,de,d);let b=0;o.value==="subcategory"&&(b=40),X=f+b}else X=0,o.value==="subcategory"&&(X+=40);const fe=a+te+X,ne=fe+R.value*(r+v)+a;if(l.width=W,l.height=ne,e.fillStyle="white",e.fillRect(0,0,W,ne),e.fillStyle="black",e.font=`bold ${w}px ${c}`,e.textAlign="center",e.textBaseline="top",e.fillText(L,W/2,a),x.value==="fill"){e.font=`${A}px ${c}`,e.textAlign="left",e.textBaseline="alphabetic",e.fillStyle="#333";const d=Se(e,D,a,a+te,de,A+15);if(o.value==="subcategory"){e.fillStyle="#666",e.font=`20px ${c}`;const f="“通常怪兽”/“效果怪兽”是非额外非灵摆怪兽，“灵摆怪兽”是非额外怪兽。";e.fillText(f,a,d+10)}}else if(o.value==="subcategory"){e.fillStyle="#666",e.font=`20px ${c}`,e.textAlign="center",e.textBaseline="alphabetic";const d="“通常怪兽”/“效果怪兽”是非额外非灵摆怪兽，“灵摆怪兽”是非额外怪兽。";e.fillText(d,W/2,a+te)}const Me=h.value*i+(h.value-1)*u,Ae=(W-Me)/2;for(let d=0;d<n.length;d++){const f=n[d];if(!f)continue;const b=Math.floor(d/h.value),U=d%h.value,y=Ae+U*(i+u),T=fe+b*(r+v);if(f.isPendulum?e.drawImage(f.img,y,T+20,256,216):e.drawImage(f.img,y,T,256,256),e.strokeStyle="#ddd",e.lineWidth=2,e.strokeRect(y,T,256,256),x.value==="fill"){e.font=`bold ${Ce}px ${c}`,e.fillStyle="#000",e.textAlign="left",e.textBaseline="alphabetic",e.fillText(`#${d+1}`,y+5,T+r+33);const _=y+i/2+13,S=T+r+33;if(e.font=`${B}px ${c}`,e.textAlign="center",t){const k=Z.value.indexOf(f.answer),C=k!==-1?`${k+1}.`:"";e.fillText(`( ${C}${f.answer} )`,_,S)}else e.fillText("(          )",_,S)}else{const _=y+i/2,S=T+r+33;if(e.font=`bold ${B}px ${c}`,e.textAlign="center",e.textBaseline="alphabetic",t){const k=j.value,C=f.isMatchTarget;(k?!C:C)?(e.save(),e.strokeStyle="#dc3545",e.lineWidth=6,e.strokeRect(y,T,256,256),e.restore(),e.fillStyle="#dc3545"):(e.save(),e.fillStyle="rgba(255, 255, 255, 0.65)",e.fillRect(y,T,256,256),e.restore(),e.fillStyle="#999"),e.fillText(f.answer,_,S),e.fillStyle="black"}else e.fillStyle="#000",e.fillText(`#${d+1}`,_,S)}if(t&&f.name){e.save();const _=24;e.font=`bold ${_}px ${c}`;let S=e.measureText(f.name).width;const k=i-10;let C=_;if(S>k){const le=k/S;C=Math.floor(_*le),e.font=`bold ${C}px ${c}`,S=k}const K=C+14,ve=T+256-K;let pe=.65;if(x.value==="judge"){const le=j.value,me=f.isMatchTarget;(le?!me:me)||(pe=.42)}e.fillStyle=`rgba(0, 0, 0, ${pe})`,e.fillRect(y,ve,i,K),e.fillStyle="#fff",e.textAlign="center",e.textBaseline="middle",e.fillText(f.name,y+i/2,ve+K/2),e.restore()}}e.fillStyle="#999",e.font=`14px ${c}`,e.textAlign="right",e.textBaseline="alphabetic",e.fillText("Created by Wanakachi",W-10,ne-10)},ce=l=>{const n=l?J.value:Q.value;if(!n)return;const t=n.toDataURL("image/png"),e=document.createElement("a");e.href=t,e.download=l?"游戏王卡图猜猜杯_答案.png":"游戏王卡图猜猜杯_题目.png",e.click()};return(l,n)=>(z(),G(ge,null,[He,s("div",Ye,[s("div",Oe,[Pe,s("div",Le,[s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":n[0]||(n[0]=t=>x.value=t),value:"fill"},null,512),[[F,x.value]]),$(" 填空题")]),s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":n[1]||(n[1]=t=>x.value=t),value:"judge"},null,512),[[F,x.value]]),$(" 判断题")])])]),s("div",De,[Xe,s("div",Ke,[s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":n[2]||(n[2]=t=>o.value=t),value:"race"},null,512),[[F,o.value]]),$(" 种族")]),s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":n[3]||(n[3]=t=>o.value=t),value:"attribute"},null,512),[[F,o.value]]),$(" 属性")]),s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":n[4]||(n[4]=t=>o.value=t),value:"category"},null,512),[[F,o.value]]),$(" 卡片种类")]),s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":n[5]||(n[5]=t=>o.value=t),value:"subcategory"},null,512),[[F,o.value]]),$(" 细分种类")])])]),x.value==="judge"?(z(),G("div",qe,[Qe,s("div",null,[Je,g(s("input",{type:"number","onUpdate:modelValue":n[6]||(n[6]=t=>V.value=t),min:"1",max:R.value*h.value-1,class:"num-input",style:{width:"60px"}},null,8,Ze),[[se,V.value,void 0,{number:!0}]]),et,g(s("select",{"onUpdate:modelValue":n[7]||(n[7]=t=>p.value=t),class:"select-input"},[(z(!0),G(ge,null,je(Z.value,t=>(z(),G("option",{key:t,value:t},xe(t),9,tt))),128))],512),[[Ve,p.value]]),s("label",nt,[g(s("input",{type:"checkbox","onUpdate:modelValue":n[8]||(n[8]=t=>j.value=t)},null,512),[[be,j.value]]),$(" 反选 (找“不是”的) ")])])])):ye("",!0),s("div",lt,[st,s("div",null,[g(s("input",{type:"number","onUpdate:modelValue":n[9]||(n[9]=t=>R.value=t),min:"1",max:"10",class:"num-input"},null,512),[[se,R.value,void 0,{number:!0}]]),$(" 行 × "),g(s("input",{type:"number","onUpdate:modelValue":n[10]||(n[10]=t=>h.value=t),min:"1",max:"10",class:"num-input"},null,512),[[se,h.value,void 0,{number:!0}]]),$(" 列 ")])]),s("div",it,[at,s("div",null,[s("label",null,[g(s("input",{type:"checkbox","onUpdate:modelValue":n[11]||(n[11]=t=>O.value=t)},null,512),[[be,O.value]]),$(" 只看常用卡")])])]),s("div",ot,[s("button",{onClick:ke,disabled:M.value||P.value,class:"btns primary-btn"},xe(P.value?"数据初始化...":M.value?"生成中...":"绘制图片"),9,ut),s("button",{onClick:n[12]||(n[12]=t=>ce(!1)),disabled:!N.value,class:"btns download-btn"},"下载图片",8,rt),s("button",{onClick:n[13]||(n[13]=t=>ce(!0)),disabled:!N.value,class:"btns download-btn"},"下载答案",8,ct)])]),s("div",dt,[N.value?(z(),G("canvas",{key:0,ref_key:"canvasVisible",ref:Q},null,512)):ye("",!0),s("canvas",{ref_key:"canvasHidden",ref:J,style:{display:"none"}},null,512)]),ft],64))}},bt=Be(vt,[["__scopeId","data-v-381332b6"]]);export{bt as default};
