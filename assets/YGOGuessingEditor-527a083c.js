import{_ as Be,r as m,w as ge,j as Ue,o as Ve,a as I,c as N,b as s,e as g,k as V,h as y,f as ae,l as je,F as be,d as Fe,t as xe,v as ye,i as _e,m as Ie,p as Ne,g as ze}from"./index-8e09c5ee.js";import{F as Ge,l as He,s as X}from"./utils-0b72f588.js";import"./_commonjsHelpers-de833af9.js";const k=z=>(Ne("data-v-24f70f2b"),z=z(),ze(),z),Oe=k(()=>s("h1",null,"游戏王卡图猜猜杯制作器",-1)),Pe={id:"input-container"},Ye={id:"modes-settings"},Le=k(()=>s("span",{id:"matching-hint"},"题目形式: ",-1)),De={class:"radio-group"},Xe={id:"modes-settings"},Ke=k(()=>s("span",{id:"matching-hint"},"主题选择: ",-1)),qe={class:"radio-group"},Qe={key:0,id:"modes-settings"},Je=k(()=>s("span",{id:"matching-hint"},"判断配置: ",-1)),Ze=k(()=>s("span",{style:{"font-size":"14px",margin:"0 5px"}},"找出",-1)),et=["max"],tt=k(()=>s("span",{style:{"font-size":"14px",margin:"0 5px 10px 5px"}},"个",-1)),nt=["value"],lt={style:{"margin-left":"10px","font-weight":"normal"}},st={id:"modes-settings"},it=k(()=>s("span",{id:"matching-hint"},"矩阵大小: ",-1)),at={id:"modes-settings"},ot=k(()=>s("span",{id:"matching-hint"},"筛选设置: ",-1)),ut={id:"button-container"},rt=["disabled"],ct=["disabled"],dt=["disabled"],ft={id:"canvas-container"},vt=Ie('<div id="notice" data-v-24f70f2b><p data-v-24f70f2b>卡图及卡片数据来源： <a href="https://ygocdb.com" data-v-24f70f2b>百鸽</a></p><p data-v-24f70f2b>常用卡统计来源： <a href="https://mycard.world/ygopro/arena/index.html" data-v-24f70f2b>MCPro 决斗数据库</a></p><p data-v-24f70f2b>种族/属性/种类信息摘自： <a href="https://zh.wikipedia.org/wiki/%E9%81%8A%E6%88%B2%E7%8E%8B%E9%9B%86%E6%8F%9B%E7%B4%99%E7%89%8C%E9%81%8A%E6%88%B2" data-v-24f70f2b>游戏王中文维基</a></p><p data-v-24f70f2b>注意：数据更新有延迟。请查看 <a href="https://github.com/WatanabeChika/Wana_tools/blob/main/README.md" data-v-24f70f2b> README </a> 获取最近更新时间。 </p></div>',1),pt={__name:"YGOGuessingEditor",setup(z){const j=["龙","魔法师","不死","战士","兽战士","兽","鸟兽","恶魔","天使","昆虫","恐龙","爬虫类","鱼","海龙","机械","雷","水","炎","岩石","植物","念动力","幻龙","电子界","幻想魔","幻神兽","创造神"],G=["暗","光","地","水","炎","风","神"],oe=["怪兽","魔法","陷阱"],ue=["通常怪兽","效果怪兽","仪式怪兽","融合怪兽","同调怪兽","超量怪兽","灵摆怪兽","连接怪兽","通常魔法","仪式魔法","速攻魔法","永续魔法","装备魔法","场地魔法","通常陷阱","永续陷阱","反击陷阱"],b=m("fill"),o=m("race"),C=m(3),h=m(4),H=m(!1),p=m(""),M=m(1),W=m(!1),E=m(!1),O=m(!0),F=m(!1),K=m(null),q=m(null);let re=[],ce=new Set;ge(o,l=>{l==="race"?p.value=j[0]:l==="attribute"?p.value=G[0]:l==="category"?p.value=oe[0]:l==="subcategory"&&(p.value=ue[0])}),ge([C,h],([l,t])=>{const n=l*t-1;M.value>n&&(M.value=Math.max(1,n))});const Q=Ue(()=>o.value==="race"?j:o.value==="attribute"?G:o.value==="category"?oe:o.value==="subcategory"?ue:[]),$e=new Ge("KaiTi");Ve(async()=>{const l=$e.check(),t=fetch("cards/cards.json").then(e=>e.json()).then(e=>{const a=e.default||e;re=Object.values(a)}),n=fetch("cards/common_cards.json").then(e=>e.json()).then(e=>{const a=e.default||e;ce=new Set(a.map(i=>Number(i)))}).catch(()=>null);try{await Promise.all([l,t,n]),p.value=j[0],O.value=!1}catch(e){console.error("初始化失败",e),alert("数据加载发生错误，请刷新重试")}});const J=(l,t)=>{if(!l||!l.text||!l.text.types)return!1;const n=l.text.types,e=o.value;if(e==="category"){if(t==="怪兽")return n.includes("怪兽");if(t==="魔法")return n.includes("魔法");if(t==="陷阱")return n.includes("陷阱")}else if(e==="subcategory"){if(t==="通常怪兽")return n.includes("通常")&&n.includes("怪兽");if(t==="效果怪兽")return!n.includes("通常")&&n.includes("怪兽")&&!n.includes("仪式")&&!n.includes("融合")&&!n.includes("同调")&&!n.includes("超量")&&!n.includes("连接")&&!n.includes("灵摆");const a=t.replace("怪兽","").replace("魔法","").replace("陷阱","");return t==="通常魔法"?n.includes("魔法")&&!["仪式","速攻","永续","装备","场地"].some(i=>n.includes(i)):t==="通常陷阱"?n.includes("陷阱")&&!["永续","反击"].some(i=>n.includes(i)):n.includes(a)}else if(e==="race"){const a=/](.*?)\/(.*?)(\n|$)/,i=n.match(a);return i?i[1].includes(t):n.includes(t)}else if(e==="attribute"){const a=/](.*?)\/(.*?)(\n|$)/,i=n.match(a);return i?i[2].includes(t):n.includes(t)}return!1},we=l=>{if(!l||!l.text||!l.text.types)return"未知";const t=l.text.types;if(o.value==="category")return t.includes("魔法")?"魔法":t.includes("陷阱")?"陷阱":t.includes("怪兽")?"怪兽":"未知";if(o.value==="subcategory")return t.includes("魔法")?t.includes("仪式")?"仪式魔法":t.includes("速攻")?"速攻魔法":t.includes("永续")?"永续魔法":t.includes("装备")?"装备魔法":t.includes("场地")?"场地魔法":"通常魔法":t.includes("陷阱")?t.includes("永续")?"永续陷阱":t.includes("反击")?"反击陷阱":"通常陷阱":t.includes("仪式")?"仪式怪兽":t.includes("融合")?"融合怪兽":t.includes("同调")?"同调怪兽":t.includes("超量")?"超量怪兽":t.includes("连接")?"连接怪兽":t.includes("灵摆")?"灵摆怪兽":t.includes("通常")?"通常怪兽":"效果怪兽";const n=/](.*?)\/(.*?)(\n|$)/,e=t.match(n);if(e){const a=e[1].trim(),i=e[2].trim();if(o.value==="race")return j.find(u=>a===u||a.includes(u))||"未知";if(o.value==="attribute")return G.find(u=>i===u||i.includes(u))||"未知"}return o.value==="attribute"?G.find(i=>t.includes("/"+i)||t.includes("/ "+i))||"未知":[...j].sort((r,u)=>u.length-r.length).find(r=>t.includes(r))||"未知"},Te=async()=>{if(O.value)return alert("数据正在初始化，请稍后再试..."),[];let l=re;(o.value==="race"||o.value==="attribute")&&(l=l.filter(n=>n.text&&n.text.types&&n.text.types.includes("怪兽"))),H.value&&(l=l.filter(n=>ce.has(Number(n.id))));const t=C.value*h.value;if(b.value==="fill")return X([...l],!1).slice(0,C.value*h.value);{const n=p.value,e=Math.min(Math.max(1,M.value),t-1),a=W.value,i=l.filter(B=>J(B,n)),r=l.filter(B=>!J(B,n));let u=0,v=0;if(a?(v=e,u=t-e):(u=e,v=t-e),i.length<u||r.length<v)return alert(`卡池数量不足。
需要符合卡：${u}张 (现有${i.length})
需要干扰卡：${v}张 (现有${r.length})`),[];const d=X([...i],!1),w=X([...r],!1),R=[...d.slice(0,u),...w.slice(0,v)];return X(R,!1)}},Se=(l,t,n,e,a,i)=>{const r=t.split("  ");let u="",v=e;for(let d=0;d<r.length;d++){const w=u+r[d]+"  ";l.measureText(w).width>a&&d>0?(l.fillText(u,n,v),u=r[d]+"  ",v+=i):u=w}return l.fillText(u,n,v),v+i},ke=(l,t,n,e)=>{const a=t.split("  ");let i="",r=1;for(let u=0;u<a.length;u++){const v=i+a[u]+"  ";l.measureText(v).width>n&&u>0?(i=a[u]+"  ",r++):i=v}return r*e},Ce=async()=>{if(!E.value){E.value=!0,F.value=!1;try{const l=await Te();if(l.length===0){E.value=!1,H.value?alert("未找到符合条件的常用卡数据"):alert("未找到数据");return}const t=await Promise.all(l.map(async n=>{const e=n.text.types.includes("灵摆"),a=e?"!artp":"!art",i=`cdn.233.momobako.com/ygopro/pics/${n.id}.jpg${a}`,r=`https://wsrv.nl/?url=${encodeURIComponent(i)}&t=${new Date().getTime()}_${Math.random()}`;try{const u=await He(r),v=J(n,p.value);return{img:u,isPendulum:e,answer:we(n),isMatchTarget:v,name:n.cn_name||n.jp_name||"未知卡名"}}catch(u){return console.warn(`Failed to load image for card ${n.id}`,u),null}}));setTimeout(()=>{F.value=!0,setTimeout(()=>{de(K.value,t,!1),de(q.value,t,!0),E.value=!1},50)},0)}catch(l){console.error(l),alert("生成过程中发生错误"),E.value=!1}}},de=(l,t,n)=>{if(!l)return;const e=l.getContext("2d"),a=40,i=256,r=256,u=20,v=60,d="KaiTi",w=48,R=28,B=28,Ee=24;let P="",Y="",L=0;if(b.value==="fill"){let f="";o.value==="race"?f="种族":o.value==="attribute"?f="属性":o.value==="category"?f="卡片种类":o.value==="subcategory"&&(f="细分种类"),P=`看游戏王卡图猜${f}`,Y=Q.value.map((c,x)=>`${x+1}.${c}`).join("  ")}else{const f=M.value,c=W.value;let x="";f===1?x=c?"唯一一个非":"唯一一个":x=c?"所有非":"所有";let A="";o.value==="race"?A=`${p.value}族的怪兽`:o.value==="attribute"?A=`${p.value}属性的怪兽`:o.value==="category"?A=`${p.value}卡`:o.value==="subcategory"&&(A=`${p.value}卡`),P=`看游戏王卡图找出${x}${A}`,Y=""}const Z=100;e.font=`bold ${w}px ${d}`;const Re=e.measureText(P).width,Ae=i*h.value+u*(h.value-1),U=Math.max(800,Ae+a*2,Re+a*2);if(b.value==="fill"){e.font=`${R}px ${d}`;const f=R+15,c=ke(e,Y,contentWidth,f);let x=0;o.value==="subcategory"&&(x=40),L=c+x}else L=0,o.value==="subcategory"&&(L+=40);const ve=a+Z+L,ee=ve+C.value*(r+v)+a;if(l.width=U,l.height=ee,e.fillStyle="white",e.fillRect(0,0,U,ee),e.fillStyle="black",e.font=`bold ${w}px ${d}`,e.textAlign="center",e.textBaseline="top",e.fillText(P,U/2,a),b.value==="fill"){e.font=`${R}px ${d}`,e.textAlign="left",e.textBaseline="alphabetic",e.fillStyle="#333";const f=Se(e,Y,a,a+Z,contentWidth,R+15);if(o.value==="subcategory"){e.fillStyle="#666",e.font=`20px ${d}`;const c="“通常怪兽”/“效果怪兽”是非额外非灵摆怪兽，“灵摆怪兽”是非额外怪兽。";e.fillText(c,a,f+10)}}else if(o.value==="subcategory"){e.fillStyle="#666",e.font=`20px ${d}`,e.textAlign="center",e.textBaseline="alphabetic";const f="“通常怪兽”/“效果怪兽”是非额外非灵摆怪兽，“灵摆怪兽”是非额外怪兽。";e.fillText(f,U/2,a+Z)}const Me=h.value*i+(h.value-1)*u,We=(U-Me)/2;for(let f=0;f<t.length;f++){const c=t[f];if(!c)continue;const x=Math.floor(f/h.value),A=f%h.value,_=We+A*(i+u),T=ve+x*(r+v);c.isPendulum?e.drawImage(c.img,_,T+20,256,216):e.drawImage(c.img,_,T,256,256),e.strokeStyle="#ddd",e.lineWidth=2,e.strokeRect(_,T,256,256),e.font=`bold ${Ee}px ${d}`,e.fillStyle="#000",e.textAlign="left",e.textBaseline="alphabetic",e.fillText(`#${f+1}`,_+5,T+r+33);const te=_+i/2+13,ne=T+r+33;if(e.font=`${B}px ${d}`,e.textAlign="center",n){if(b.value==="fill"){const $=Q.value.indexOf(c.answer),S=$!==-1?`${$+1}.`:"";e.fillText(`( ${S}${c.answer} )`,te,ne)}else{const $=W.value,S=c.isMatchTarget;($?!S:S)?(e.save(),e.strokeStyle="#dc3545",e.lineWidth=6,e.strokeRect(_,T,256,256),e.restore(),e.fillStyle="#dc3545"):(e.save(),e.fillStyle="rgba(255, 255, 255, 0.65)",e.fillRect(_,T,256,256),e.restore(),e.fillStyle="#999"),e.fillText(`( ${c.answer} )`,te,ne),e.fillStyle="black"}if(c.name){e.save();const $=24;e.font=`bold ${$}px ${d}`;let S=e.measureText(c.name).width;const D=i-10;let le=$;if(S>D){const ie=D/S;le=Math.floor($*ie),e.font=`bold ${le}px ${d}`,S=D}const se=le+14,pe=T+256-se;let me=.65;if(b.value==="judge"){const ie=W.value,he=c.isMatchTarget;(ie?!he:he)||(me=.42)}e.fillStyle=`rgba(0, 0, 0, ${me})`,e.fillRect(_,pe,i,se),e.fillStyle="#fff",e.textAlign="center",e.textBaseline="middle",e.fillText(c.name,_+i/2,pe+se/2),e.restore()}}else e.fillText("(          )",te,ne)}e.fillStyle="#999",e.font=`14px ${d}`,e.textAlign="right",e.textBaseline="alphabetic",e.fillText("Created by Wanakachi",U-10,ee-10)},fe=l=>{const t=l?q.value:K.value;if(!t)return;const n=t.toDataURL("image/png"),e=document.createElement("a");e.href=n,e.download=l?"游戏王卡图猜猜杯_答案.png":"游戏王卡图猜猜杯_题目.png",e.click()};return(l,t)=>(I(),N(be,null,[Oe,s("div",Pe,[s("div",Ye,[Le,s("div",De,[s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=n=>b.value=n),value:"fill"},null,512),[[V,b.value]]),y(" 填空题")]),s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=n=>b.value=n),value:"judge"},null,512),[[V,b.value]]),y(" 判断题")])])]),s("div",Xe,[Ke,s("div",qe,[s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":t[2]||(t[2]=n=>o.value=n),value:"race"},null,512),[[V,o.value]]),y(" 种族")]),s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=n=>o.value=n),value:"attribute"},null,512),[[V,o.value]]),y(" 属性")]),s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=n=>o.value=n),value:"category"},null,512),[[V,o.value]]),y(" 卡片种类")]),s("label",null,[g(s("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=n=>o.value=n),value:"subcategory"},null,512),[[V,o.value]]),y(" 细分种类")])])]),b.value==="judge"?(I(),N("div",Qe,[Je,s("div",null,[Ze,g(s("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=n=>M.value=n),min:"1",max:C.value*h.value-1,class:"num-input",style:{width:"60px"}},null,8,et),[[ae,M.value,void 0,{number:!0}]]),tt,g(s("select",{"onUpdate:modelValue":t[7]||(t[7]=n=>p.value=n),class:"select-input"},[(I(!0),N(be,null,Fe(Q.value,n=>(I(),N("option",{key:n,value:n},xe(n),9,nt))),128))],512),[[je,p.value]]),s("label",lt,[g(s("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=n=>W.value=n)},null,512),[[ye,W.value]]),y(" 反选 (找“不是”的) ")])])])):_e("",!0),s("div",st,[it,s("div",null,[g(s("input",{type:"number","onUpdate:modelValue":t[9]||(t[9]=n=>C.value=n),min:"1",max:"10",class:"num-input"},null,512),[[ae,C.value,void 0,{number:!0}]]),y(" 行 × "),g(s("input",{type:"number","onUpdate:modelValue":t[10]||(t[10]=n=>h.value=n),min:"1",max:"10",class:"num-input"},null,512),[[ae,h.value,void 0,{number:!0}]]),y(" 列 ")])]),s("div",at,[ot,s("div",null,[s("label",null,[g(s("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=n=>H.value=n)},null,512),[[ye,H.value]]),y(" 只看常用卡")])])]),s("div",ut,[s("button",{onClick:Ce,disabled:E.value||O.value,class:"btns primary-btn"},xe(O.value?"数据初始化...":E.value?"生成中...":"绘制图片"),9,rt),s("button",{onClick:t[12]||(t[12]=n=>fe(!1)),disabled:!F.value,class:"btns download-btn"},"下载图片",8,ct),s("button",{onClick:t[13]||(t[13]=n=>fe(!0)),disabled:!F.value,class:"btns download-btn"},"下载答案",8,dt)])]),s("div",ft,[F.value?(I(),N("canvas",{key:0,ref_key:"canvasVisible",ref:K},null,512)):_e("",!0),s("canvas",{ref_key:"canvasHidden",ref:q,style:{display:"none"}},null,512)]),vt],64))}},yt=Be(pt,[["__scopeId","data-v-24f70f2b"]]);export{yt as default};
